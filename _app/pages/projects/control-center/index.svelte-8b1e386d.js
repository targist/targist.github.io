var Re=Object.defineProperty,Me=Object.defineProperties;var Ne=Object.getOwnPropertyDescriptors;var de=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable;var ce=(t,e,r)=>e in t?Re(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,U=(t,e)=>{for(var r in e||(e={}))Pe.call(e,r)&&ce(t,r,e[r]);if(de)for(var r of de(e))Ae.call(e,r)&&ce(t,r,e[r]);return t},V=(t,e)=>Me(t,Ne(e));import{a3 as w,a4 as le,a5 as fe,a6 as Ee,a7 as De,a8 as Je,a9 as Te,S as z,i as q,s as Z,J as xe,e as I,c as O,a as S,d as p,b as d,g as y,a1 as ne,K as Be,L as Ke,M as Ue,q as $,o as R,a2 as Ve,aa as H,k as N,w as A,m as P,x as E,H as k,y as J,B as T,N as x,O as B,ab as He,ac as Le,ad as We,ae as Fe,af as ze,l as ue,I as L,C as ae,P as se,t as W,h as F,ag as qe,j as $e,ah as Ze,ai as Ge,_ as Qe,aj as Xe,v as Ye,ak as je,n as et,p as tt}from"../../../chunks/vendor-f69eef5c.js";import{S as rt}from"../../../chunks/SecurityCheckPage-fd916499.js";import{P as nt,S as it,a as at,e as st}from"../../../chunks/StandardTopBar-5f4d220e.js";/* empty css                          */import"../../../chunks/singletons-d1fb5791.js";function ve(){return{uid:"",streamId:"",name:"",isMobile:!1}}const G={encode(t,e=w.Writer.create()){return t.uid!==""&&e.uint32(34).string(t.uid),t.streamId!==""&&e.uint32(10).string(t.streamId),t.name!==""&&e.uint32(18).string(t.name),t.isMobile===!0&&e.uint32(24).bool(t.isMobile),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ve();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 4:i.uid=r.string();break;case 1:i.streamId=r.string();break;case 2:i.name=r.string();break;case 3:i.isMobile=r.bool();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{uid:C(t.uid)?String(t.uid):"",streamId:C(t.streamId)?String(t.streamId):"",name:C(t.name)?String(t.name):"",isMobile:C(t.isMobile)?Boolean(t.isMobile):!1}},toJSON(t){const e={};return t.uid!==void 0&&(e.uid=t.uid),t.streamId!==void 0&&(e.streamId=t.streamId),t.name!==void 0&&(e.name=t.name),t.isMobile!==void 0&&(e.isMobile=t.isMobile),e},fromPartial(t){var r,n,i,a;const e=ve();return e.uid=(r=t.uid)!=null?r:"",e.streamId=(n=t.streamId)!=null?n:"",e.name=(i=t.name)!=null?i:"",e.isMobile=(a=t.isMobile)!=null?a:!1,e}};function he(){return{offer:""}}const Q={encode(t,e=w.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=he();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:C(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=he();return e.offer=(r=t.offer)!=null?r:"",e}};function me(){return{offer:""}}const X={encode(t,e=w.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=me();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:C(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=me();return e.offer=(r=t.offer)!=null?r:"",e}};function pe(){return{answer:""}}const Y={encode(t,e=w.Writer.create()){return t.answer!==""&&e.uint32(26).string(t.answer),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=pe();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.answer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{answer:C(t.answer)?String(t.answer):""}},toJSON(t){const e={};return t.answer!==void 0&&(e.answer=t.answer),e},fromPartial(t){var r;const e=pe();return e.answer=(r=t.answer)!=null?r:"",e}};function ge(){return{iceCandidate:""}}const j={encode(t,e=w.Writer.create()){return t.iceCandidate!==""&&e.uint32(26).string(t.iceCandidate),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ge();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.iceCandidate=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{iceCandidate:C(t.iceCandidate)?String(t.iceCandidate):""}},toJSON(t){const e={};return t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate),e},fromPartial(t){var r;const e=ge();return e.iceCandidate=(r=t.iceCandidate)!=null?r:"",e}};function we(){return{setName:void 0,p2pMessage:void 0}}const ot={encode(t,e=w.Writer.create()){return t.setName!==void 0&&ee.encode(t.setName,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&K.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=we();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.setName=ee.decode(r,r.uint32());break;case 2:i.p2pMessage=K.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{setName:C(t.setName)?ee.fromJSON(t.setName):void 0,p2pMessage:C(t.p2pMessage)?K.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.setName!==void 0&&(e.setName=t.setName?ee.toJSON(t.setName):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?K.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=we();return e.setName=t.setName!==void 0&&t.setName!==null?ee.fromPartial(t.setName):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?K.fromPartial(t.p2pMessage):void 0,e}};function ke(){return{id:"",name:""}}const ee={encode(t,e=w.Writer.create()){return t.id!==""&&e.uint32(10).string(t.id),t.name!==""&&e.uint32(18).string(t.name),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ke();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.id=r.string();break;case 2:i.name=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{id:C(t.id)?String(t.id):"",name:C(t.name)?String(t.name):""}},toJSON(t){const e={};return t.id!==void 0&&(e.id=t.id),t.name!==void 0&&(e.name=t.name),e},fromPartial(t){var r,n;const e=ke();return e.id=(r=t.id)!=null?r:"",e.name=(n=t.name)!=null?n:"",e}};function _e(){return{connectedDevices:[]}}const te={encode(t,e=w.Writer.create()){for(const r of t.connectedDevices)G.encode(r,e.uint32(18).fork()).ldelim();return e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=_e();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 2:i.connectedDevices.push(G.decode(r,r.uint32()));break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{connectedDevices:Array.isArray(t==null?void 0:t.connectedDevices)?t.connectedDevices.map(e=>G.fromJSON(e)):[]}},toJSON(t){const e={};return t.connectedDevices?e.connectedDevices=t.connectedDevices.map(r=>r?G.toJSON(r):void 0):e.connectedDevices=[],e},fromPartial(t){var r;const e=_e();return e.connectedDevices=((r=t.connectedDevices)==null?void 0:r.map(n=>G.fromPartial(n)))||[],e}};function Se(){return{serverState:void 0,p2pMessage:void 0}}const dt={encode(t,e=w.Writer.create()){return t.serverState!==void 0&&te.encode(t.serverState,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&K.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Se();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.serverState=te.decode(r,r.uint32());break;case 2:i.p2pMessage=K.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{serverState:C(t.serverState)?te.fromJSON(t.serverState):void 0,p2pMessage:C(t.p2pMessage)?K.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.serverState!==void 0&&(e.serverState=t.serverState?te.toJSON(t.serverState):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?K.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=Se();return e.serverState=t.serverState!==void 0&&t.serverState!==null?te.fromPartial(t.serverState):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?K.fromPartial(t.p2pMessage):void 0,e}};function be(){return{senderId:"",receiverId:"",senderUid:"",rtcOffer:void 0,rtcAnswer:void 0,iceCandidate:void 0,initialRtcOffer:void 0}}const K={encode(t,e=w.Writer.create()){return t.senderId!==""&&e.uint32(10).string(t.senderId),t.receiverId!==""&&e.uint32(18).string(t.receiverId),t.senderUid!==""&&e.uint32(26).string(t.senderUid),t.rtcOffer!==void 0&&X.encode(t.rtcOffer,e.uint32(34).fork()).ldelim(),t.rtcAnswer!==void 0&&Y.encode(t.rtcAnswer,e.uint32(42).fork()).ldelim(),t.iceCandidate!==void 0&&j.encode(t.iceCandidate,e.uint32(50).fork()).ldelim(),t.initialRtcOffer!==void 0&&Q.encode(t.initialRtcOffer,e.uint32(58).fork()).ldelim(),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=be();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.senderId=r.string();break;case 2:i.receiverId=r.string();break;case 3:i.senderUid=r.string();break;case 4:i.rtcOffer=X.decode(r,r.uint32());break;case 5:i.rtcAnswer=Y.decode(r,r.uint32());break;case 6:i.iceCandidate=j.decode(r,r.uint32());break;case 7:i.initialRtcOffer=Q.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{senderId:C(t.senderId)?String(t.senderId):"",receiverId:C(t.receiverId)?String(t.receiverId):"",senderUid:C(t.senderUid)?String(t.senderUid):"",rtcOffer:C(t.rtcOffer)?X.fromJSON(t.rtcOffer):void 0,rtcAnswer:C(t.rtcAnswer)?Y.fromJSON(t.rtcAnswer):void 0,iceCandidate:C(t.iceCandidate)?j.fromJSON(t.iceCandidate):void 0,initialRtcOffer:C(t.initialRtcOffer)?Q.fromJSON(t.initialRtcOffer):void 0}},toJSON(t){const e={};return t.senderId!==void 0&&(e.senderId=t.senderId),t.receiverId!==void 0&&(e.receiverId=t.receiverId),t.senderUid!==void 0&&(e.senderUid=t.senderUid),t.rtcOffer!==void 0&&(e.rtcOffer=t.rtcOffer?X.toJSON(t.rtcOffer):void 0),t.rtcAnswer!==void 0&&(e.rtcAnswer=t.rtcAnswer?Y.toJSON(t.rtcAnswer):void 0),t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate?j.toJSON(t.iceCandidate):void 0),t.initialRtcOffer!==void 0&&(e.initialRtcOffer=t.initialRtcOffer?Q.toJSON(t.initialRtcOffer):void 0),e},fromPartial(t){var r,n,i;const e=be();return e.senderId=(r=t.senderId)!=null?r:"",e.receiverId=(n=t.receiverId)!=null?n:"",e.senderUid=(i=t.senderUid)!=null?i:"",e.rtcOffer=t.rtcOffer!==void 0&&t.rtcOffer!==null?X.fromPartial(t.rtcOffer):void 0,e.rtcAnswer=t.rtcAnswer!==void 0&&t.rtcAnswer!==null?Y.fromPartial(t.rtcAnswer):void 0,e.iceCandidate=t.iceCandidate!==void 0&&t.iceCandidate!==null?j.fromPartial(t.iceCandidate):void 0,e.initialRtcOffer=t.initialRtcOffer!==void 0&&t.initialRtcOffer!==null?Q.fromPartial(t.initialRtcOffer):void 0,e}};function Ce(){return{forward:0,right:0}}const re={encode(t,e=w.Writer.create()){return t.forward!==0&&e.uint32(8).int32(t.forward),t.right!==0&&e.uint32(16).int32(t.right),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Ce();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.forward=r.int32();break;case 2:i.right=r.int32();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{forward:C(t.forward)?Number(t.forward):0,right:C(t.right)?Number(t.right):0}},toJSON(t){const e={};return t.forward!==void 0&&(e.forward=Math.round(t.forward)),t.right!==void 0&&(e.right=Math.round(t.right)),e},fromPartial(t){var r,n;const e=Ce();return e.forward=(r=t.forward)!=null?r:0,e.right=(n=t.right)!=null?n:0,e}};function Ie(){return{directionCommand:void 0}}const ct={encode(t,e=w.Writer.create()){return t.directionCommand!==void 0&&re.encode(t.directionCommand,e.uint32(10).fork()).ldelim(),e},decode(t,e){const r=t instanceof w.Reader?t:new w.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Ie();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.directionCommand=re.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{directionCommand:C(t.directionCommand)?re.fromJSON(t.directionCommand):void 0}},toJSON(t){const e={};return t.directionCommand!==void 0&&(e.directionCommand=t.directionCommand?re.toJSON(t.directionCommand):void 0),e},fromPartial(t){const e=Ie();return e.directionCommand=t.directionCommand!==void 0&&t.directionCommand!==null?re.fromPartial(t.directionCommand):void 0,e}};w.util.Long!==le&&(w.util.Long=le,w.configure());function C(t){return t!=null}function lt(t){const{url:e,isDevice:r,clientId:n,token:i}=t,a=new URL(e+"/events");a.searchParams.append("stream",n),a.searchParams.append("token",i);const c=new URL(e+"/command");c.searchParams.append("token",i);const s=new Ee(o=>{const m=new EventSource(a,{withCredentials:!1});return m.onmessage=l=>{o.closed||o.next(dt.decode(fe.Buffer.from(l.data,"base64")))},()=>m.close()}).pipe(De({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}));return{sendCommand(o){fetch(c.toString(),{method:"POST",body:fe.Buffer.from(ot.encode(o).finish()).toString("base64")})},onMessage(){return s},closeStream(){fetch(c.toString(),{method:"DELETE"})}}}class ft{constructor(e){this.robotService=e}async onIceCandidate(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,iceCandidate:{iceCandidate:JSON.stringify(i)}}})}async sendInitialOffer(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,initialRtcOffer:{offer:JSON.stringify(i)}}})}async sendAnswer(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,rtcAnswer:{answer:JSON.stringify(i)}}})}}class ut{constructor(e){const{clientId:r,onMedia:n,peerId:i,uid:a,rtcpHandler:c}=e;this.clientId=r,this.peerId=i,this.uid=a,this.rtcpPeerConnection=new RTCPeerConnection,this.rtcpHandler=c,this.signalizationDataChannel=this.rtcpPeerConnection.createDataChannel("signalization",{id:0,ordered:!0}),this.rtcpPeerConnection.onicecandidate=s=>{this.rtcpHandler.onIceCandidate(this.clientId,i,this.uid,s.candidate)},n({state:"notReady"}),this.rtcpPeerConnection.ontrack=s=>{s.track.onended=()=>{n({state:"notReady"})},s.track.readyState=="live"&&n({state:"ready",mediaStream:s.streams[0]})}}close(){this.rtcpPeerConnection.close()}async call(){const e=await this.rtcpPeerConnection.createOffer({offerToReceiveVideo:!0});await this.rtcpPeerConnection.setLocalDescription(e),await this.rtcpHandler.sendInitialOffer(this.clientId,this.peerId,this.uid,e)}async receiveInitialOfferAndSendAnswer(e){await this.rtcpPeerConnection.setRemoteDescription(e);const r=await this.rtcpPeerConnection.createAnswer();await this.rtcpPeerConnection.setLocalDescription(r),this.rtcpHandler.sendAnswer(this.clientId,this.peerId,this.uid,r)}async addIceCandidate(e){try{await this.rtcpPeerConnection.addIceCandidate(e)}catch(r){console.log(r)}}async receiveOffer(e){await this.rtcpPeerConnection.setRemoteDescription(e)}sendMessage(e){this.signalizationDataChannel.send(e)}}class vt{constructor(e){this.state=new Je({type:"NotPeered"});const{onDevices:r,onMedia:n,clientId:i,signalingServerUrl:a,token:c,uid:s}=e;this.clientId=i,this.onMedia=n,this.uid=s;const o=lt({url:a,isDevice:!1,clientId:this.clientId,token:c});this.rtcpHandler=new ft(o),this.serverObservable=o.onMessage().pipe(Te(async m=>{var l;switch(!0){case m.p2pMessage!=null:{const v=m.p2pMessage,h=v.senderId;if(h!=((l=this.rtcPeerDecorator)==null?void 0:l.peerId))return;switch(!0){case v.initialRtcOffer!=null:{this.rtcPeerDecorator=this.createRTCPDecorator(h),await this.rtcPeerDecorator.receiveInitialOfferAndSendAnswer(JSON.parse(v.initialRtcOffer.offer));break}case v.iceCandidate!=null:{await this.rtcPeerDecorator.addIceCandidate(JSON.parse(v.iceCandidate.iceCandidate));break}case v.rtcOffer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(v.rtcOffer.offer));break}case v.rtcAnswer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(v.rtcAnswer.answer));break}}break}case m.serverState!=null:{const{connectedDevices:v}=m.serverState;r(v),v.find(h=>h.streamId!=this.clientId)||this.closeCurrentCall()}}return m}),De({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}))}closeStream(){this.robotService.closeStream()}start(){this.subscription=this.serverObservable.subscribe()}stop(){var e;(e=this.subscription)==null||e.unsubscribe()}call(e){this.rtcPeerDecorator=this.createRTCPDecorator(e),this.rtcPeerDecorator.call(),this.state.next({type:"Peered",peerId:e})}sendMessage(e){var r;(r=this.rtcPeerDecorator)==null||r.sendMessage(e)}closeCurrentCall(){var e;(e=this.rtcPeerDecorator)==null||e.close(),this.rtcPeerDecorator=null,this.state.next({type:"NotPeered"})}createRTCPDecorator(e){return this.rtcPeerDecorator&&this.closeCurrentCall(),new ut({clientId:this.clientId,uid:this.uid,onMedia:this.onMedia,peerId:e,rtcpHandler:this.rtcpHandler})}}function ht(t){let e,r,n,i,a;const c=t[5].default,s=xe(c,t,t[4],null);return{c(){e=I("div"),s&&s.c(),this.h()},l(o){e=O(o,"DIV",{class:!0});var m=S(e);s&&s.l(m),m.forEach(p),this.h()},h(){d(e,"class",r="flex flex-row place-items-center place-content-center border-2 border-emerald-500 rounded-xl "+(t[1]?"bg-bluemiddle":"bg-bluelight"))},m(o,m){y(o,e,m),s&&s.m(e,null),n=!0,i||(a=[ne(window,"keydown",t[6]),ne(window,"keyup",t[7]),ne(e,"mousedown",t[8]),ne(e,"mouseup",t[9])],i=!0)},p(o,[m]){s&&s.p&&(!n||m&16)&&Be(s,c,o,o[4],n?Ue(c,o[4],m,null):Ke(o[4]),null),(!n||m&2&&r!==(r="flex flex-row place-items-center place-content-center border-2 border-emerald-500 rounded-xl "+(o[1]?"bg-bluemiddle":"bg-bluelight")))&&d(e,"class",r)},i(o){n||($(s,o),n=!0)},o(o){R(s,o),n=!1},d(o){o&&p(e),s&&s.d(o),i=!1,Ve(a)}}}function mt(t,e,r){let{$$slots:n={},$$scope:i}=e,{key:a}=e,{directionEventHandler:c}=e,s=!1;function o(u){r(1,s=u),c(u?{eventType:"KeyDown",direction:a}:{eventType:"KeyReleased",direction:a})}const m=u=>{u.metaKey||u.ctrlKey||u.shiftKey||u.key==a&&(o(!0),u.preventDefault())},l=u=>{u.metaKey||u.ctrlKey||u.shiftKey||u.key==a&&(o(!1),u.preventDefault())},v=()=>o(!0),h=()=>o(!1);return t.$$set=u=>{"key"in u&&r(0,a=u.key),"directionEventHandler"in u&&r(3,c=u.directionEventHandler),"$$scope"in u&&r(4,i=u.$$scope)},[a,s,o,c,i,n,m,l,v,h]}class ie extends z{constructor(e){super();q(this,e,mt,ht,Z,{key:0,directionEventHandler:3})}}function pt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=B(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=S(e);r=B(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),S(r).forEach(p),i.forEach(p),this.h()},h(){d(r,"stroke-linecap","round"),d(r,"stroke-linejoin","round"),d(r,"stroke-width","2"),d(r,"d","M5 15l7-7 7 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-6 w-6"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(n,i){y(n,e,i),k(e,r)},d(n){n&&p(e)}}}function gt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=B(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=S(e);r=B(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),S(r).forEach(p),i.forEach(p),this.h()},h(){d(r,"stroke-linecap","round"),d(r,"stroke-linejoin","round"),d(r,"stroke-width","2"),d(r,"d","M15 19l-7-7 7-7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-6 w-6"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(n,i){y(n,e,i),k(e,r)},d(n){n&&p(e)}}}function wt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=B(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=S(e);r=B(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),S(r).forEach(p),i.forEach(p),this.h()},h(){d(r,"stroke-linecap","round"),d(r,"stroke-linejoin","round"),d(r,"stroke-width","2"),d(r,"d","M19 9l-7 7-7-7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-6 w-6"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(n,i){y(n,e,i),k(e,r)},d(n){n&&p(e)}}}function kt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=B(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=S(e);r=B(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),S(r).forEach(p),i.forEach(p),this.h()},h(){d(r,"stroke-linecap","round"),d(r,"stroke-linejoin","round"),d(r,"stroke-width","2"),d(r,"d","M9 5l7 7-7 7"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-6 w-6"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(n,i){y(n,e,i),k(e,r)},d(n){n&&p(e)}}}function _t(t){let e,r,n,i,a,c,s,o,m,l,v,h,u;return i=new ie({props:{key:H.Key.ArrowUp,directionEventHandler:t[0],$$slots:{default:[pt]},$$scope:{ctx:t}}}),o=new ie({props:{key:H.Key.ArrowLeft,directionEventHandler:t[0],$$slots:{default:[gt]},$$scope:{ctx:t}}}),l=new ie({props:{key:H.Key.ArrowDown,directionEventHandler:t[0],$$slots:{default:[wt]},$$scope:{ctx:t}}}),h=new ie({props:{key:H.Key.ArrowRight,directionEventHandler:t[0],$$slots:{default:[kt]},$$scope:{ctx:t}}}),{c(){e=I("div"),r=I("div"),n=N(),A(i.$$.fragment),a=N(),c=I("div"),s=N(),A(o.$$.fragment),m=N(),A(l.$$.fragment),v=N(),A(h.$$.fragment),this.h()},l(f){e=O(f,"DIV",{class:!0});var g=S(e);r=O(g,"DIV",{}),S(r).forEach(p),n=P(g),E(i.$$.fragment,g),a=P(g),c=O(g,"DIV",{}),S(c).forEach(p),s=P(g),E(o.$$.fragment,g),m=P(g),E(l.$$.fragment,g),v=P(g),E(h.$$.fragment,g),g.forEach(p),this.h()},h(){d(e,"class","grid grid-cols-3 grid-rows-2 w-64 h-24 gap-1 bg-slate-200 p-2 rounded-2xl border-2 border-slate-300")},m(f,g){y(f,e,g),k(e,r),k(e,n),J(i,e,null),k(e,a),k(e,c),k(e,s),J(o,e,null),k(e,m),J(l,e,null),k(e,v),J(h,e,null),u=!0},p(f,[g]){const _={};g&1&&(_.directionEventHandler=f[0]),g&2&&(_.$$scope={dirty:g,ctx:f}),i.$set(_);const b={};g&1&&(b.directionEventHandler=f[0]),g&2&&(b.$$scope={dirty:g,ctx:f}),o.$set(b);const D={};g&1&&(D.directionEventHandler=f[0]),g&2&&(D.$$scope={dirty:g,ctx:f}),l.$set(D);const M={};g&1&&(M.directionEventHandler=f[0]),g&2&&(M.$$scope={dirty:g,ctx:f}),h.$set(M)},i(f){u||($(i.$$.fragment,f),$(o.$$.fragment,f),$(l.$$.fragment,f),$(h.$$.fragment,f),u=!0)},o(f){R(i.$$.fragment,f),R(o.$$.fragment,f),R(l.$$.fragment,f),R(h.$$.fragment,f),u=!1},d(f){f&&p(e),T(i),T(o),T(l),T(h)}}}function St(t,e,r){let{directionFn:n}=e;return t.$$set=i=>{"directionFn"in i&&r(0,n=i.directionFn)},[n]}class bt extends z{constructor(e){super();q(this,e,St,_t,Z,{directionFn:0})}}function Ct(t){const e=new He;return e.pipe(Le((r,n)=>{switch(n.direction){case H.Key.ArrowUp:switch(n.eventType){case"KeyDown":return V(U({},r),{ArrowUp:1});case"KeyReleased":return V(U({},r),{ArrowUp:0})}case H.Key.ArrowDown:switch(n.eventType){case"KeyDown":return V(U({},r),{ArrowDown:1});case"KeyReleased":return V(U({},r),{ArrowDown:0})}case H.Key.ArrowLeft:switch(n.eventType){case"KeyDown":return V(U({},r),{ArrowLeft:1});case"KeyReleased":return V(U({},r),{ArrowLeft:0})}case H.Key.ArrowRight:switch(n.eventType){case"KeyDown":return V(U({},r),{ArrowRight:1});case"KeyReleased":return V(U({},r),{ArrowRight:0})}}},{ArrowUp:0,ArrowDown:0,ArrowRight:0,ArrowLeft:0}),We(r=>({directionCommand:{forward:(r.ArrowUp-r.ArrowDown)*100,right:(r.ArrowRight-r.ArrowLeft)*100}})),Fe(300,ze,{trailing:!0,leading:!1})).subscribe({next:r=>{t(r)}}),r=>{e.next(r)}}function It(t){let e,r,n;return{c(){e=I("div"),r=W("Video not available"),this.h()},l(i){e=O(i,"DIV",{class:!0});var a=S(e);r=F(a,"Video not available"),a.forEach(p),this.h()},h(){d(e,"class",n=`${t[2].class} bg-slate-200 text-lg`)},m(i,a){y(i,e,a),k(e,r)},p(i,a){a&4&&n!==(n=`${i[2].class} bg-slate-200 text-lg`)&&d(e,"class",n)},d(i){i&&p(e)}}}function Ot(t){let e,r,n,i,a;return{c(){e=I("video"),r=I("track"),this.h()},l(c){e=O(c,"VIDEO",{class:!0});var s=S(e);r=O(s,"TRACK",{kind:!0}),s.forEach(p),this.h()},h(){d(r,"kind","captions"),e.autoplay=!0,d(e,"class",n=t[2].class)},m(c,s){y(c,e,s),k(e,r),i||(a=qe(t[1].call(null,e)),i=!0)},p(c,s){s&4&&n!==(n=c[2].class)&&d(e,"class",n)},d(c){c&&p(e),i=!1,a()}}}function yt(t){let e;function r(a,c){return a[0]&&a[0].state=="ready"?Ot:It}let n=r(t),i=n(t);return{c(){i.c(),e=ue()},l(a){i.l(a),e=ue()},m(a,c){i.m(a,c),y(a,e,c)},p(a,[c]){n===(n=r(a))&&i?i.p(a,c):(i.d(1),i=n(a),i&&(i.c(),i.m(e.parentNode,e)))},i:L,o:L,d(a){i.d(a),a&&p(e)}}}function Dt(t,e,r){let{mediaState:n}=e;function i(a){n&&n.state=="ready"&&(a.srcObject=n.mediaStream)}return t.$$set=a=>{r(2,e=ae(ae({},e),se(a))),"mediaState"in a&&r(0,n=a.mediaState)},e=se(e),[n,i,e]}class $t extends z{constructor(e){super();q(this,e,Dt,yt,Z,{mediaState:0})}}function Rt(t){let e,r,n,i,a,c,s,o,m,l,v,h;return s=new $t({props:{mediaState:t[1],class:"flex flex-grow place-content-center place-items-center bg-black rounded-2xl aspect-video h-96"}}),l=new bt({props:{directionFn:t[5]}}),{c(){e=I("div"),r=I("div"),n=I("span"),i=W("Device Id"),a=W(t[0]),c=N(),A(s.$$.fragment),o=N(),m=I("div"),A(l.$$.fragment),this.h()},l(u){e=O(u,"DIV",{class:!0});var f=S(e);r=O(f,"DIV",{class:!0});var g=S(r);n=O(g,"SPAN",{class:!0});var _=S(n);i=F(_,"Device Id"),_.forEach(p),a=F(g,t[0]),g.forEach(p),c=P(f),E(s.$$.fragment,f),o=P(f),m=O(f,"DIV",{class:!0});var b=S(m);E(l.$$.fragment,b),b.forEach(p),f.forEach(p),this.h()},h(){d(n,"class","bg-light-gray text-bluestrong text-sm font-medium mr-2 px-2.5 py-0.5 rounded"),d(r,"class","my-3"),d(m,"class","m-3"),d(e,"class",v=t[3].class)},m(u,f){y(u,e,f),k(e,r),k(r,n),k(n,i),k(r,a),k(e,c),J(s,e,null),k(e,o),k(e,m),J(l,m,null),h=!0},p(u,[f]){(!h||f&1)&&$e(a,u[0]);const g={};f&2&&(g.mediaState=u[1]),s.$set(g),(!h||f&8&&v!==(v=u[3].class))&&d(e,"class",v)},i(u){h||($(s.$$.fragment,u),$(l.$$.fragment,u),h=!0)},o(u){R(s.$$.fragment,u),R(l.$$.fragment,u),h=!1},d(u){u&&p(e),T(s),T(l)}}}function Mt(t,e,r){let{peerId:n}=e,{mediaState:i}=e,{directionFn:a}=e;const c=Ct(a),s=o=>{c(o)};return t.$$set=o=>{r(3,e=ae(ae({},e),se(o))),"peerId"in o&&r(0,n=o.peerId),"mediaState"in o&&r(1,i=o.mediaState),"directionFn"in o&&r(4,a=o.directionFn)},e=se(e),[n,i,c,e,a,s]}class Nt extends z{constructor(e){super();q(this,e,Mt,Rt,Z,{peerId:0,mediaState:1,directionFn:4})}}function Oe(t,e,r){const n=t.slice();return n[4]=e[r],n}function Pt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=B(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=S(e);r=B(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),S(r).forEach(p),i.forEach(p),this.h()},h(){d(r,"stroke-linecap","round"),d(r,"stroke-linejoin","round"),d(r,"stroke-width","2"),d(r,"d","M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-6 w-6 mr-2"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(n,i){y(n,e,i),k(e,r)},d(n){n&&p(e)}}}function At(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=B(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=S(e);r=B(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),S(r).forEach(p),i.forEach(p),this.h()},h(){d(r,"stroke-linecap","round"),d(r,"stroke-linejoin","round"),d(r,"stroke-width","2"),d(r,"d","M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"),d(e,"xmlns","http://www.w3.org/2000/svg"),d(e,"class","h-6 w-6 mr-2"),d(e,"fill","none"),d(e,"viewBox","0 0 24 24"),d(e,"stroke","currentColor")},m(n,i){y(n,e,i),k(e,r)},d(n){n&&p(e)}}}function ye(t,e){let r,n,i,a,c=e[4].streamId+"",s,o,m,l,v;function h(_,b){return _[4].isMobile?At:Pt}let u=h(e),f=u(e);function g(){return e[3](e[4])}return{key:t,first:null,c(){r=I("div"),n=I("div"),f.c(),i=N(),a=I("div"),s=W(c),m=N(),this.h()},l(_){r=O(_,"DIV",{class:!0});var b=S(r);n=O(b,"DIV",{class:!0});var D=S(n);f.l(D),i=P(D),a=O(D,"DIV",{});var M=S(a);s=F(M,c),M.forEach(p),D.forEach(p),m=P(b),b.forEach(p),this.h()},h(){d(n,"class",o="flex flex-row rounded-lg p-1 "+(e[2]==e[4].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400"),d(r,"class","box-border my-2 px-3"),this.first=r},m(_,b){y(_,r,b),k(r,n),f.m(n,null),k(n,i),k(n,a),k(a,s),k(r,m),l||(v=ne(n,"click",g),l=!0)},p(_,b){e=_,u!==(u=h(e))&&(f.d(1),f=u(e),f&&(f.c(),f.m(n,i))),b&1&&c!==(c=e[4].streamId+"")&&$e(s,c),b&5&&o!==(o="flex flex-row rounded-lg p-1 "+(e[2]==e[4].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400")&&d(n,"class",o)},d(_){_&&p(r),f.d(),l=!1,v()}}}function Et(t){let e,r,n,i,a,c=[],s=new Map,o=t[0];const m=l=>l[4].streamId;for(let l=0;l<o.length;l+=1){let v=Oe(t,o,l),h=m(v);s.set(h,c[l]=ye(h,v))}return{c(){e=I("div"),r=I("div"),n=W("Available devices"),i=N(),a=I("div");for(let l=0;l<c.length;l+=1)c[l].c();this.h()},l(l){e=O(l,"DIV",{class:!0});var v=S(e);r=O(v,"DIV",{class:!0});var h=S(r);n=F(h,"Available devices"),h.forEach(p),v.forEach(p),i=P(l),a=O(l,"DIV",{class:!0});var u=S(a);for(let f=0;f<c.length;f+=1)c[f].l(u);u.forEach(p),this.h()},h(){d(r,"class","text-center text-gray"),d(e,"class","w-full shadow-sm py-2"),d(a,"class","overflow-y-scroll")},m(l,v){y(l,e,v),k(e,r),k(r,n),y(l,i,v),y(l,a,v);for(let h=0;h<c.length;h+=1)c[h].m(a,null)},p(l,[v]){v&7&&(o=l[0],c=Ze(c,v,m,1,l,o,s,a,Ge,ye,null,Oe))},i:L,o:L,d(l){l&&p(e),l&&p(i),l&&p(a);for(let v=0;v<c.length;v+=1)c[v].d()}}}function Jt(t,e,r){let{devices:n}=e,{selectDevice:i}=e,a="";const c=s=>{r(2,a=s.streamId),i(s.streamId)};return t.$$set=s=>{"devices"in s&&r(0,n=s.devices),"selectDevice"in s&&r(1,i=s.selectDevice)},[n,i,a,c]}class Tt extends z{constructor(e){super();q(this,e,Jt,Et,Z,{devices:0,selectDevice:1})}}function xt(t){let e,r;return e=new it({props:{slot:"topbar"}}),{c(){A(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,i){J(e,n,i),r=!0},p:L,i(n){r||($(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function Bt(t){let e,r;return{c(){e=I("div"),r=W("Select a device"),this.h()},l(n){e=O(n,"DIV",{class:!0});var i=S(e);r=F(i,"Select a device"),i.forEach(p),this.h()},h(){d(e,"class","flex flex-grow place-items-center place-content-center text-xl text-gray")},m(n,i){y(n,e,i),k(e,r)},p:L,i:L,o:L,d(n){n&&p(e)}}}function Kt(t){let e,r;return e=new Nt({props:{class:"flex flex-grow flex-col shadow-lg p-4 border-2 border-gray-100 rounded-lg",peerId:t[2].peerId,mediaState:t[1],directionFn:t[6]}}),{c(){A(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,i){J(e,n,i),r=!0},p(n,i){const a={};i&4&&(a.peerId=n[2].peerId),i&2&&(a.mediaState=n[1]),i&8&&(a.directionFn=n[6]),e.$set(a)},i(n){r||($(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function Ut(t){let e,r,n,i,a,c,s,o,m,l,v,h;const u=[Kt,Bt],f=[];function g(_,b){return _[2]&&_[2].type=="Peered"?0:1}return s=g(t),o=f[s]=u[s](t),v=new Tt({props:{selectDevice:t[7],devices:t[0]}}),{c(){e=I("div"),r=I("div"),n=I("div"),i=W("Control center for device: "),a=W(t[4]),c=N(),o.c(),m=N(),l=I("div"),A(v.$$.fragment),this.h()},l(_){e=O(_,"DIV",{slot:!0,class:!0});var b=S(e);r=O(b,"DIV",{class:!0});var D=S(r);n=O(D,"DIV",{class:!0});var M=S(n);i=F(M,"Control center for device: "),a=F(M,t[4]),M.forEach(p),c=P(D),o.l(D),D.forEach(p),m=P(b),l=O(b,"DIV",{class:!0});var oe=S(l);E(v.$$.fragment,oe),oe.forEach(p),b.forEach(p),this.h()},h(){d(n,"class","textxl text-gray"),d(r,"class","flex flex-grow flex-col m-5"),d(l,"class","flex flex-col flex-grow max-w-md shadow-md"),d(e,"slot","main"),d(e,"class","flex flex-row flex-grow")},m(_,b){y(_,e,b),k(e,r),k(r,n),k(n,i),k(n,a),k(r,c),f[s].m(r,null),k(e,m),k(e,l),J(v,l,null),h=!0},p(_,b){let D=s;s=g(_),s===D?f[s].p(_,b):(et(),R(f[D],1,1,()=>{f[D]=null}),tt(),o=f[s],o?o.p(_,b):(o=f[s]=u[s](_),o.c()),$(o,1),o.m(r,null));const M={};b&8&&(M.selectDevice=_[7]),b&1&&(M.devices=_[0]),v.$set(M)},i(_){h||($(o),$(v.$$.fragment,_),h=!0)},o(_){R(o),R(v.$$.fragment,_),h=!1},d(_){_&&p(e),f[s].d(),T(v)}}}function Vt(t){let e,r;return e=new nt({props:{$$slots:{main:[Ut],topbar:[xt]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,i){J(e,n,i),r=!0},p(n,[i]){const a={};i&527&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||($(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function Ht(t,e,r){let n,i;Qe(t,at,h=>r(5,i=h));let a=Xe(),c=[],s,o,m;Ye(async()=>{n.type=="LoggedIn"&&(r(3,m=new vt({clientId:a,uid:n.user.uid,onDevices:h=>{r(0,c=h.filter(u=>u.streamId!=a&&u.isMobile))},onMedia:h=>{r(1,s=h)},signalingServerUrl:st.robotService.url,token:await n.user.getIdToken()})),m.start(),m.state.subscribe({next:h=>{r(2,o=h)}}))}),je(()=>{m==null||m.stop()});const l=h=>{m.sendMessage(ct.encode(h).finish())},v=h=>{m.call(h)};return t.$$.update=()=>{t.$$.dirty&32&&(n=i.authState)},[c,s,o,m,a,i,l,v]}class Lt extends z{constructor(e){super();q(this,e,Ht,Vt,Z,{})}}function Wt(t){let e,r;return e=new Lt({}),{c(){A(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,i){J(e,n,i),r=!0},i(n){r||($(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function Ft(t){let e,r;return e=new rt({props:{denyIfNotAuthenticated:!0,$$slots:{default:[Wt]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(n){E(e.$$.fragment,n)},m(n,i){J(e,n,i),r=!0},p(n,[i]){const a={};i&1&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||($(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}class Yt extends z{constructor(e){super();q(this,e,null,Ft,Z,{})}}export{Yt as default};
