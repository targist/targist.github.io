import{a0 as v,a1 as re,a2 as ne,a3 as ke,a4 as ge,a5 as Ie,a6 as _e,S as K,i as X,s as F,l as ie,g as M,I as R,d as p,C as Q,P as Y,e as w,t as J,c as O,a as _,h as A,b as l,H as g,a7 as we,k as U,w as $,m as V,x,y as E,j as Se,q as N,o as P,B as T,_ as Oe,a8 as Ce,a9 as be,N as j,O as ee,X as Me,aa as De,v as ye,ab as Ne,n as Pe,p as Re}from"../../../chunks/vendor-0f82600e.js";import{S as Je}from"../../../chunks/SecurityCheckPage-2315a045.js";import{P as Ae,a as $e,S as xe}from"../../../chunks/StandardTopBar-28389ac7.js";/* empty css                          */import"../../../chunks/singletons-d1fb5791.js";const Ee=Te();function Te(){return{robotService:{url:"http://localhost:8080"}}}function ae(){return{uid:"",streamId:"",name:"",isMobile:!1}}const B={encode(t,e=v.Writer.create()){return t.uid!==""&&e.uint32(34).string(t.uid),t.streamId!==""&&e.uint32(10).string(t.streamId),t.name!==""&&e.uint32(18).string(t.name),t.isMobile===!0&&e.uint32(24).bool(t.isMobile),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ae();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 4:i.uid=r.string();break;case 1:i.streamId=r.string();break;case 2:i.name=r.string();break;case 3:i.isMobile=r.bool();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{uid:I(t.uid)?String(t.uid):"",streamId:I(t.streamId)?String(t.streamId):"",name:I(t.name)?String(t.name):"",isMobile:I(t.isMobile)?Boolean(t.isMobile):!1}},toJSON(t){const e={};return t.uid!==void 0&&(e.uid=t.uid),t.streamId!==void 0&&(e.streamId=t.streamId),t.name!==void 0&&(e.name=t.name),t.isMobile!==void 0&&(e.isMobile=t.isMobile),e},fromPartial(t){var r,n,i,a;const e=ae();return e.uid=(r=t.uid)!=null?r:"",e.streamId=(n=t.streamId)!=null?n:"",e.name=(i=t.name)!=null?i:"",e.isMobile=(a=t.isMobile)!=null?a:!1,e}};function se(){return{offer:""}}const H={encode(t,e=v.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=se();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:I(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=se();return e.offer=(r=t.offer)!=null?r:"",e}};function oe(){return{offer:""}}const W={encode(t,e=v.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=oe();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:I(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=oe();return e.offer=(r=t.offer)!=null?r:"",e}};function ce(){return{answer:""}}const L={encode(t,e=v.Writer.create()){return t.answer!==""&&e.uint32(26).string(t.answer),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ce();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.answer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{answer:I(t.answer)?String(t.answer):""}},toJSON(t){const e={};return t.answer!==void 0&&(e.answer=t.answer),e},fromPartial(t){var r;const e=ce();return e.answer=(r=t.answer)!=null?r:"",e}};function de(){return{iceCandidate:""}}const z={encode(t,e=v.Writer.create()){return t.iceCandidate!==""&&e.uint32(26).string(t.iceCandidate),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=de();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.iceCandidate=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{iceCandidate:I(t.iceCandidate)?String(t.iceCandidate):""}},toJSON(t){const e={};return t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate),e},fromPartial(t){var r;const e=de();return e.iceCandidate=(r=t.iceCandidate)!=null?r:"",e}};function le(){return{setName:void 0,p2pMessage:void 0}}const Ue={encode(t,e=v.Writer.create()){return t.setName!==void 0&&q.encode(t.setName,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&y.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=le();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.setName=q.decode(r,r.uint32());break;case 2:i.p2pMessage=y.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{setName:I(t.setName)?q.fromJSON(t.setName):void 0,p2pMessage:I(t.p2pMessage)?y.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.setName!==void 0&&(e.setName=t.setName?q.toJSON(t.setName):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?y.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=le();return e.setName=t.setName!==void 0&&t.setName!==null?q.fromPartial(t.setName):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?y.fromPartial(t.p2pMessage):void 0,e}};function fe(){return{id:"",name:""}}const q={encode(t,e=v.Writer.create()){return t.id!==""&&e.uint32(10).string(t.id),t.name!==""&&e.uint32(18).string(t.name),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=fe();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.id=r.string();break;case 2:i.name=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{id:I(t.id)?String(t.id):"",name:I(t.name)?String(t.name):""}},toJSON(t){const e={};return t.id!==void 0&&(e.id=t.id),t.name!==void 0&&(e.name=t.name),e},fromPartial(t){var r,n;const e=fe();return e.id=(r=t.id)!=null?r:"",e.name=(n=t.name)!=null?n:"",e}};function ue(){return{connectedDevices:[]}}const Z={encode(t,e=v.Writer.create()){for(const r of t.connectedDevices)B.encode(r,e.uint32(18).fork()).ldelim();return e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ue();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 2:i.connectedDevices.push(B.decode(r,r.uint32()));break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{connectedDevices:Array.isArray(t==null?void 0:t.connectedDevices)?t.connectedDevices.map(e=>B.fromJSON(e)):[]}},toJSON(t){const e={};return t.connectedDevices?e.connectedDevices=t.connectedDevices.map(r=>r?B.toJSON(r):void 0):e.connectedDevices=[],e},fromPartial(t){var r;const e=ue();return e.connectedDevices=((r=t.connectedDevices)==null?void 0:r.map(n=>B.fromPartial(n)))||[],e}};function ve(){return{serverState:void 0,p2pMessage:void 0}}const Ve={encode(t,e=v.Writer.create()){return t.serverState!==void 0&&Z.encode(t.serverState,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&y.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ve();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.serverState=Z.decode(r,r.uint32());break;case 2:i.p2pMessage=y.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{serverState:I(t.serverState)?Z.fromJSON(t.serverState):void 0,p2pMessage:I(t.p2pMessage)?y.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.serverState!==void 0&&(e.serverState=t.serverState?Z.toJSON(t.serverState):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?y.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=ve();return e.serverState=t.serverState!==void 0&&t.serverState!==null?Z.fromPartial(t.serverState):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?y.fromPartial(t.p2pMessage):void 0,e}};function he(){return{senderId:"",receiverId:"",senderUid:"",rtcOffer:void 0,rtcAnswer:void 0,iceCandidate:void 0,initialRtcOffer:void 0}}const y={encode(t,e=v.Writer.create()){return t.senderId!==""&&e.uint32(10).string(t.senderId),t.receiverId!==""&&e.uint32(18).string(t.receiverId),t.senderUid!==""&&e.uint32(26).string(t.senderUid),t.rtcOffer!==void 0&&W.encode(t.rtcOffer,e.uint32(34).fork()).ldelim(),t.rtcAnswer!==void 0&&L.encode(t.rtcAnswer,e.uint32(42).fork()).ldelim(),t.iceCandidate!==void 0&&z.encode(t.iceCandidate,e.uint32(50).fork()).ldelim(),t.initialRtcOffer!==void 0&&H.encode(t.initialRtcOffer,e.uint32(58).fork()).ldelim(),e},decode(t,e){const r=t instanceof v.Reader?t:new v.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=he();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.senderId=r.string();break;case 2:i.receiverId=r.string();break;case 3:i.senderUid=r.string();break;case 4:i.rtcOffer=W.decode(r,r.uint32());break;case 5:i.rtcAnswer=L.decode(r,r.uint32());break;case 6:i.iceCandidate=z.decode(r,r.uint32());break;case 7:i.initialRtcOffer=H.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{senderId:I(t.senderId)?String(t.senderId):"",receiverId:I(t.receiverId)?String(t.receiverId):"",senderUid:I(t.senderUid)?String(t.senderUid):"",rtcOffer:I(t.rtcOffer)?W.fromJSON(t.rtcOffer):void 0,rtcAnswer:I(t.rtcAnswer)?L.fromJSON(t.rtcAnswer):void 0,iceCandidate:I(t.iceCandidate)?z.fromJSON(t.iceCandidate):void 0,initialRtcOffer:I(t.initialRtcOffer)?H.fromJSON(t.initialRtcOffer):void 0}},toJSON(t){const e={};return t.senderId!==void 0&&(e.senderId=t.senderId),t.receiverId!==void 0&&(e.receiverId=t.receiverId),t.senderUid!==void 0&&(e.senderUid=t.senderUid),t.rtcOffer!==void 0&&(e.rtcOffer=t.rtcOffer?W.toJSON(t.rtcOffer):void 0),t.rtcAnswer!==void 0&&(e.rtcAnswer=t.rtcAnswer?L.toJSON(t.rtcAnswer):void 0),t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate?z.toJSON(t.iceCandidate):void 0),t.initialRtcOffer!==void 0&&(e.initialRtcOffer=t.initialRtcOffer?H.toJSON(t.initialRtcOffer):void 0),e},fromPartial(t){var r,n,i;const e=he();return e.senderId=(r=t.senderId)!=null?r:"",e.receiverId=(n=t.receiverId)!=null?n:"",e.senderUid=(i=t.senderUid)!=null?i:"",e.rtcOffer=t.rtcOffer!==void 0&&t.rtcOffer!==null?W.fromPartial(t.rtcOffer):void 0,e.rtcAnswer=t.rtcAnswer!==void 0&&t.rtcAnswer!==null?L.fromPartial(t.rtcAnswer):void 0,e.iceCandidate=t.iceCandidate!==void 0&&t.iceCandidate!==null?z.fromPartial(t.iceCandidate):void 0,e.initialRtcOffer=t.initialRtcOffer!==void 0&&t.initialRtcOffer!==null?H.fromPartial(t.initialRtcOffer):void 0,e}};v.util.Long!==re&&(v.util.Long=re,v.configure());function I(t){return t!=null}function Be(t){const{url:e,isDevice:r,clientId:n,token:i}=t;let a=new URL(e+"/events");a.searchParams.append("stream",n),a.searchParams.append("token",i);let d=new URL(e+"/command");d.searchParams.append("token",i);const o=new ke(f=>{const u=new EventSource(a,{withCredentials:!1});return u.onmessage=c=>{f.closed||f.next(Ve.decode(ne.Buffer.from(c.data,"base64")))},()=>u.close()}).pipe(ge({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}));return{sendCommand(f){fetch(d.toString(),{method:"POST",body:ne.Buffer.from(Ue.encode(f).finish()).toString("base64")})},onMessage(){return o},closeStream(){fetch(d.toString(),{method:"DELETE"})}}}class He{constructor(e){this.robotService=e}async onIceCandidate(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,iceCandidate:{iceCandidate:JSON.stringify(i)}}})}async sendInitialOffer(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,initialRtcOffer:{offer:JSON.stringify(i)}}})}async sendAnswer(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,rtcAnswer:{answer:JSON.stringify(i)}}})}}class We{constructor(e){const{clientId:r,onMedia:n,peerId:i,uid:a,rtcpHandler:d}=e;this.clientId=r,this.peerId=i,this.uid=a,this.rtcpPeerConnection=new RTCPeerConnection,this.rtcpHandler=d,this.signalizationDataChannel=this.rtcpPeerConnection.createDataChannel("signalization",{id:0,ordered:!0}),this.rtcpPeerConnection.onicecandidate=o=>{this.rtcpHandler.onIceCandidate(this.clientId,i,this.uid,o.candidate)},n({state:"notReady"}),this.rtcpPeerConnection.ontrack=o=>{o.track.onended=()=>{n({state:"notReady"})},o.track.readyState=="live"&&n({state:"ready",mediaStream:o.streams[0]})}}close(){this.rtcpPeerConnection.close()}async call(){const e=await this.rtcpPeerConnection.createOffer({offerToReceiveVideo:!0});await this.rtcpPeerConnection.setLocalDescription(e),await this.rtcpHandler.sendInitialOffer(this.clientId,this.peerId,this.uid,e)}async receiveInitialOfferAndSendAnswer(e){await this.rtcpPeerConnection.setRemoteDescription(e);const r=await this.rtcpPeerConnection.createAnswer();await this.rtcpPeerConnection.setLocalDescription(r),this.rtcpHandler.sendAnswer(this.clientId,this.peerId,this.uid,r)}async addIceCandidate(e){try{await this.rtcpPeerConnection.addIceCandidate(e)}catch(r){console.log(r)}}async receiveOffer(e){await this.rtcpPeerConnection.setRemoteDescription(e)}sendMessage(e){this.signalizationDataChannel.send(e)}}class Le{constructor(e){this.state=new Ie({type:"NotPeered"});const{onDevices:r,onMedia:n,clientId:i,signalingServerUrl:a,token:d,uid:o}=e;this.clientId=i,this.onMedia=n,this.uid=o;const f=Be({url:a,isDevice:!1,clientId:this.clientId,token:d});this.rtcpHandler=new He(f),this.serverObservable=f.onMessage().pipe(_e(async u=>{var c;switch(!0){case u.p2pMessage!=null:{const s=u.p2pMessage,h=s.senderId;if(h!=((c=this.rtcPeerDecorator)==null?void 0:c.peerId))return;switch(!0){case s.initialRtcOffer!=null:{this.rtcPeerDecorator=this.createRTCPDecorator(h),await this.rtcPeerDecorator.receiveInitialOfferAndSendAnswer(JSON.parse(s.initialRtcOffer.offer));break}case s.iceCandidate!=null:{await this.rtcPeerDecorator.addIceCandidate(JSON.parse(s.iceCandidate.iceCandidate));break}case s.rtcOffer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(s.rtcOffer.offer));break}case s.rtcAnswer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(s.rtcAnswer.answer));break}}break}case u.serverState!=null:{const{connectedDevices:s}=u.serverState;r(s),s.find(h=>h.streamId!=this.clientId)||this.closeCurrentCall()}}return u}),ge({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}))}closeStream(){this.robotService.closeStream()}start(){this.subscription=this.serverObservable.subscribe()}stop(){var e;(e=this.subscription)==null||e.unsubscribe()}call(e){this.rtcPeerDecorator=this.createRTCPDecorator(e),this.rtcPeerDecorator.call(),this.state.next({type:"Peered",peerId:e})}sendMessage(e){var r;(r=this.rtcPeerDecorator)==null||r.sendMessage(e)}closeCurrentCall(){var e;(e=this.rtcPeerDecorator)==null||e.close(),this.rtcPeerDecorator=null,this.state.next({type:"NotPeered"})}createRTCPDecorator(e){return this.rtcPeerDecorator&&this.closeCurrentCall(),new We({clientId:this.clientId,uid:this.uid,onMedia:this.onMedia,peerId:e,rtcpHandler:this.rtcpHandler})}}function ze(t){let e,r,n;return{c(){e=w("div"),r=J("Video not available"),this.h()},l(i){e=O(i,"DIV",{class:!0});var a=_(e);r=A(a,"Video not available"),a.forEach(p),this.h()},h(){l(e,"class",n=`${t[2].class} bg-slate-200 text-lg`)},m(i,a){M(i,e,a),g(e,r)},p(i,a){a&4&&n!==(n=`${i[2].class} bg-slate-200 text-lg`)&&l(e,"class",n)},d(i){i&&p(e)}}}function qe(t){let e,r,n,i,a;return{c(){e=w("video"),r=w("track"),this.h()},l(d){e=O(d,"VIDEO",{class:!0});var o=_(e);r=O(o,"TRACK",{kind:!0}),o.forEach(p),this.h()},h(){l(r,"kind","captions"),e.autoplay=!0,l(e,"class",n=t[2].class)},m(d,o){M(d,e,o),g(e,r),i||(a=we(t[1].call(null,e)),i=!0)},p(d,o){o&4&&n!==(n=d[2].class)&&l(e,"class",n)},d(d){d&&p(e),i=!1,a()}}}function Ze(t){let e;function r(a,d){return a[0]&&a[0].state=="ready"?qe:ze}let n=r(t),i=n(t);return{c(){i.c(),e=ie()},l(a){i.l(a),e=ie()},m(a,d){i.m(a,d),M(a,e,d)},p(a,[d]){n===(n=r(a))&&i?i.p(a,d):(i.d(1),i=n(a),i&&(i.c(),i.m(e.parentNode,e)))},i:R,o:R,d(a){i.d(a),a&&p(e)}}}function Ke(t,e,r){let{mediaState:n}=e;function i(a){n&&n.state=="ready"&&(a.srcObject=n.mediaStream)}return t.$$set=a=>{r(2,e=Q(Q({},e),Y(a))),"mediaState"in a&&r(0,n=a.mediaState)},e=Y(e),[n,i,e]}class Xe extends K{constructor(e){super();X(this,e,Ke,Ze,F,{mediaState:0})}}function Fe(t){let e,r,n,i,a,d,o,f,u;return o=new Xe({props:{mediaState:t[1],class:"flex flex-grow place-content-center place-items-center bg-black rounded-2xl aspect-video h-96"}}),{c(){e=w("div"),r=w("div"),n=w("span"),i=J("Device Id"),a=J(t[0]),d=U(),$(o.$$.fragment),this.h()},l(c){e=O(c,"DIV",{class:!0});var s=_(e);r=O(s,"DIV",{class:!0});var h=_(r);n=O(h,"SPAN",{class:!0});var C=_(n);i=A(C,"Device Id"),C.forEach(p),a=A(h,t[0]),h.forEach(p),d=V(s),x(o.$$.fragment,s),s.forEach(p),this.h()},h(){l(n,"class","bg-light-gray text-bluestrong text-sm font-medium mr-2 px-2.5 py-0.5 rounded"),l(r,"class","my-3"),l(e,"class",f=t[2].class)},m(c,s){M(c,e,s),g(e,r),g(r,n),g(n,i),g(r,a),g(e,d),E(o,e,null),u=!0},p(c,[s]){(!u||s&1)&&Se(a,c[0]);const h={};s&2&&(h.mediaState=c[1]),o.$set(h),(!u||s&4&&f!==(f=c[2].class))&&l(e,"class",f)},i(c){u||(N(o.$$.fragment,c),u=!0)},o(c){P(o.$$.fragment,c),u=!1},d(c){c&&p(e),T(o)}}}function Ge(t,e,r){let{peerId:n}=e,{mediaState:i}=e;return t.$$set=a=>{r(2,e=Q(Q({},e),Y(a))),"peerId"in a&&r(0,n=a.peerId),"mediaState"in a&&r(1,i=a.mediaState)},e=Y(e),[n,i,e]}class Qe extends K{constructor(e){super();X(this,e,Ge,Fe,F,{peerId:0,mediaState:1})}}function pe(t,e,r){const n=t.slice();return n[4]=e[r],n}function Ye(t){let e,r;return{c(){e=j("svg"),r=j("path"),this.h()},l(n){e=ee(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=ee(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(p),i.forEach(p),this.h()},h(){l(r,"stroke-linecap","round"),l(r,"stroke-linejoin","round"),l(r,"stroke-width","2"),l(r,"d","M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"),l(e,"xmlns","http://www.w3.org/2000/svg"),l(e,"class","h-6 w-6 mr-2"),l(e,"fill","none"),l(e,"viewBox","0 0 24 24"),l(e,"stroke","currentColor")},m(n,i){M(n,e,i),g(e,r)},d(n){n&&p(e)}}}function je(t){let e,r;return{c(){e=j("svg"),r=j("path"),this.h()},l(n){e=ee(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=ee(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(p),i.forEach(p),this.h()},h(){l(r,"stroke-linecap","round"),l(r,"stroke-linejoin","round"),l(r,"stroke-width","2"),l(r,"d","M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"),l(e,"xmlns","http://www.w3.org/2000/svg"),l(e,"class","h-6 w-6 mr-2"),l(e,"fill","none"),l(e,"viewBox","0 0 24 24"),l(e,"stroke","currentColor")},m(n,i){M(n,e,i),g(e,r)},d(n){n&&p(e)}}}function me(t,e){let r,n,i,a,d=e[4].streamId+"",o,f,u,c,s;function h(m,k){return m[4].isMobile?je:Ye}let C=h(e),S=C(e);function G(){return e[3](e[4])}return{key:t,first:null,c(){r=w("div"),n=w("div"),S.c(),i=U(),a=w("div"),o=J(d),u=U(),this.h()},l(m){r=O(m,"DIV",{class:!0});var k=_(r);n=O(k,"DIV",{class:!0});var b=_(n);S.l(b),i=V(b),a=O(b,"DIV",{});var D=_(a);o=A(D,d),D.forEach(p),b.forEach(p),u=V(k),k.forEach(p),this.h()},h(){l(n,"class",f="flex flex-row rounded-lg p-1 "+(e[2]==e[4].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400"),l(r,"class","box-border my-2 px-3"),this.first=r},m(m,k){M(m,r,k),g(r,n),S.m(n,null),g(n,i),g(n,a),g(a,o),g(r,u),c||(s=Oe(n,"click",G),c=!0)},p(m,k){e=m,C!==(C=h(e))&&(S.d(1),S=C(e),S&&(S.c(),S.m(n,i))),k&1&&d!==(d=e[4].streamId+"")&&Se(o,d),k&5&&f!==(f="flex flex-row rounded-lg p-1 "+(e[2]==e[4].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400")&&l(n,"class",f)},d(m){m&&p(r),S.d(),c=!1,s()}}}function et(t){let e,r,n,i,a,d=[],o=new Map,f=t[0];const u=c=>c[4].streamId;for(let c=0;c<f.length;c+=1){let s=pe(t,f,c),h=u(s);o.set(h,d[c]=me(h,s))}return{c(){e=w("div"),r=w("div"),n=J("Available devices"),i=U(),a=w("div");for(let c=0;c<d.length;c+=1)d[c].c();this.h()},l(c){e=O(c,"DIV",{class:!0});var s=_(e);r=O(s,"DIV",{class:!0});var h=_(r);n=A(h,"Available devices"),h.forEach(p),s.forEach(p),i=V(c),a=O(c,"DIV",{class:!0});var C=_(a);for(let S=0;S<d.length;S+=1)d[S].l(C);C.forEach(p),this.h()},h(){l(r,"class","text-center text-gray"),l(e,"class","w-full shadow-sm py-2"),l(a,"class","overflow-y-scroll")},m(c,s){M(c,e,s),g(e,r),g(r,n),M(c,i,s),M(c,a,s);for(let h=0;h<d.length;h+=1)d[h].m(a,null)},p(c,[s]){s&7&&(f=c[0],d=Ce(d,s,u,1,c,f,o,a,be,me,null,pe))},i:R,o:R,d(c){c&&p(e),c&&p(i),c&&p(a);for(let s=0;s<d.length;s+=1)d[s].d()}}}function tt(t,e,r){let{devices:n}=e,{selectDevice:i}=e,a="";const d=o=>{r(2,a=o.streamId),i(o.streamId)};return t.$$set=o=>{"devices"in o&&r(0,n=o.devices),"selectDevice"in o&&r(1,i=o.selectDevice)},[n,i,a,d]}class rt extends K{constructor(e){super();X(this,e,tt,et,F,{devices:0,selectDevice:1})}}function nt(t){let e,r;return e=new xe({props:{slot:"topbar"}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){E(e,n,i),r=!0},p:R,i(n){r||(N(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function it(t){let e,r;return{c(){e=w("div"),r=J("Select a device"),this.h()},l(n){e=O(n,"DIV",{class:!0});var i=_(e);r=A(i,"Select a device"),i.forEach(p),this.h()},h(){l(e,"class","flex flex-grow place-items-center place-content-center text-xl text-gray")},m(n,i){M(n,e,i),g(e,r)},p:R,i:R,o:R,d(n){n&&p(e)}}}function at(t){let e,r;return e=new Qe({props:{class:"flex flex-grow flex-col shadow-lg p-4 border-2 border-gray-100 rounded-lg",peerId:t[2].peerId,mediaState:t[1]}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){E(e,n,i),r=!0},p(n,i){const a={};i&4&&(a.peerId=n[2].peerId),i&2&&(a.mediaState=n[1]),e.$set(a)},i(n){r||(N(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function st(t){let e,r,n,i,a,d,o,f,u,c,s,h;const C=[at,it],S=[];function G(m,k){return m[2]&&m[2].type=="Peered"?0:1}return o=G(t),f=S[o]=C[o](t),s=new rt({props:{selectDevice:t[6],devices:t[0]}}),{c(){e=w("div"),r=w("div"),n=w("div"),i=J("Control center for device: "),a=J(t[4]),d=U(),f.c(),u=U(),c=w("div"),$(s.$$.fragment),this.h()},l(m){e=O(m,"DIV",{slot:!0,class:!0});var k=_(e);r=O(k,"DIV",{class:!0});var b=_(r);n=O(b,"DIV",{class:!0});var D=_(n);i=A(D,"Control center for device: "),a=A(D,t[4]),D.forEach(p),d=V(b),f.l(b),b.forEach(p),u=V(k),c=O(k,"DIV",{class:!0});var te=_(c);x(s.$$.fragment,te),te.forEach(p),k.forEach(p),this.h()},h(){l(n,"class","textxl text-gray"),l(r,"class","flex flex-grow flex-col m-5"),l(c,"class","flex flex-col flex-grow max-w-md shadow-md"),l(e,"slot","main"),l(e,"class","flex flex-row flex-grow")},m(m,k){M(m,e,k),g(e,r),g(r,n),g(n,i),g(n,a),g(r,d),S[o].m(r,null),g(e,u),g(e,c),E(s,c,null),h=!0},p(m,k){let b=o;o=G(m),o===b?S[o].p(m,k):(Pe(),P(S[b],1,1,()=>{S[b]=null}),Re(),f=S[o],f?f.p(m,k):(f=S[o]=C[o](m),f.c()),N(f,1),f.m(r,null));const D={};k&8&&(D.selectDevice=m[6]),k&1&&(D.devices=m[0]),s.$set(D)},i(m){h||(N(f),N(s.$$.fragment,m),h=!0)},o(m){P(f),P(s.$$.fragment,m),h=!1},d(m){m&&p(e),S[o].d(),T(s)}}}function ot(t){let e,r;return e=new Ae({props:{$$slots:{main:[st],topbar:[nt]},$$scope:{ctx:t}}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){E(e,n,i),r=!0},p(n,[i]){const a={};i&271&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||(N(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function ct(t,e,r){let n,i;Me(t,$e,s=>r(5,i=s));let a=De(),d=[],o,f,u;ye(async()=>{n.type=="LoggedIn"&&(r(3,u=new Le({clientId:a,uid:n.user.uid,onDevices:s=>{r(0,d=s.filter(h=>h.streamId!=a&&h.isMobile))},onMedia:s=>{r(1,o=s)},signalingServerUrl:Ee.robotService.url,token:await n.user.getIdToken()})),u.start(),u.state.subscribe({next:s=>{r(2,f=s)}}))}),Ne(()=>{u==null||u.stop()});const c=s=>{u.call(s)};return t.$$.update=()=>{t.$$.dirty&32&&(n=i.authState)},[d,o,f,u,a,i,c]}class dt extends K{constructor(e){super();X(this,e,ct,ot,F,{})}}function lt(t){let e,r;return e=new dt({}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){E(e,n,i),r=!0},i(n){r||(N(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}function ft(t){let e,r;return e=new Je({props:{denyIfNotAuthenticated:!0,$$slots:{default:[lt]},$$scope:{ctx:t}}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){E(e,n,i),r=!0},p(n,[i]){const a={};i&1&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||(N(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){T(e,n)}}}class gt extends K{constructor(e){super();X(this,e,null,ft,F,{})}}export{gt as default};
