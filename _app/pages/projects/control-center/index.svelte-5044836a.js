import{a0 as u,a1 as re,a2 as ne,a3 as ke,a4 as ge,a5 as Ie,a6 as _e,S as K,i as X,s as F,l as ie,g as M,I as R,d as p,C as Q,P as Y,e as w,t as J,c as O,a as _,h as A,b as f,H as g,a7 as we,k as V,w as $,m as B,x,y as T,j as Se,q as D,o as P,B as E,_ as Oe,a8 as Ce,a9 as be,N as j,O as ee,X as Me,aa as ye,v as Ne,ab as De,n as Pe,p as Re}from"../../../chunks/vendor-0f82600e.js";import{S as Je}from"../../../chunks/SecurityCheckPage-2315a045.js";import{P as Ae,a as $e,S as xe}from"../../../chunks/StandardTopBar-28389ac7.js";/* empty css                          */import"../../../chunks/singletons-d1fb5791.js";const Te=Ee();function Ee(){return{robotService:{url:"https://robot-service.europe-west1.gcp.targist.com"}}}function ae(){return{uid:"",streamId:"",name:"",isMobile:!1}}const U={encode(t,e=u.Writer.create()){return t.uid!==""&&e.uint32(34).string(t.uid),t.streamId!==""&&e.uint32(10).string(t.streamId),t.name!==""&&e.uint32(18).string(t.name),t.isMobile===!0&&e.uint32(24).bool(t.isMobile),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ae();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 4:i.uid=r.string();break;case 1:i.streamId=r.string();break;case 2:i.name=r.string();break;case 3:i.isMobile=r.bool();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{uid:I(t.uid)?String(t.uid):"",streamId:I(t.streamId)?String(t.streamId):"",name:I(t.name)?String(t.name):"",isMobile:I(t.isMobile)?Boolean(t.isMobile):!1}},toJSON(t){const e={};return t.uid!==void 0&&(e.uid=t.uid),t.streamId!==void 0&&(e.streamId=t.streamId),t.name!==void 0&&(e.name=t.name),t.isMobile!==void 0&&(e.isMobile=t.isMobile),e},fromPartial(t){var r,n,i,a;const e=ae();return e.uid=(r=t.uid)!=null?r:"",e.streamId=(n=t.streamId)!=null?n:"",e.name=(i=t.name)!=null?i:"",e.isMobile=(a=t.isMobile)!=null?a:!1,e}};function se(){return{offer:""}}const H={encode(t,e=u.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=se();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:I(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=se();return e.offer=(r=t.offer)!=null?r:"",e}};function oe(){return{offer:""}}const W={encode(t,e=u.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=oe();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:I(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=oe();return e.offer=(r=t.offer)!=null?r:"",e}};function ce(){return{answer:""}}const L={encode(t,e=u.Writer.create()){return t.answer!==""&&e.uint32(26).string(t.answer),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ce();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.answer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{answer:I(t.answer)?String(t.answer):""}},toJSON(t){const e={};return t.answer!==void 0&&(e.answer=t.answer),e},fromPartial(t){var r;const e=ce();return e.answer=(r=t.answer)!=null?r:"",e}};function de(){return{iceCandidate:""}}const z={encode(t,e=u.Writer.create()){return t.iceCandidate!==""&&e.uint32(26).string(t.iceCandidate),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=de();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.iceCandidate=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{iceCandidate:I(t.iceCandidate)?String(t.iceCandidate):""}},toJSON(t){const e={};return t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate),e},fromPartial(t){var r;const e=de();return e.iceCandidate=(r=t.iceCandidate)!=null?r:"",e}};function le(){return{setName:void 0,p2pMessage:void 0}}const Ve={encode(t,e=u.Writer.create()){return t.setName!==void 0&&q.encode(t.setName,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&N.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=le();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.setName=q.decode(r,r.uint32());break;case 2:i.p2pMessage=N.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{setName:I(t.setName)?q.fromJSON(t.setName):void 0,p2pMessage:I(t.p2pMessage)?N.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.setName!==void 0&&(e.setName=t.setName?q.toJSON(t.setName):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?N.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=le();return e.setName=t.setName!==void 0&&t.setName!==null?q.fromPartial(t.setName):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?N.fromPartial(t.p2pMessage):void 0,e}};function fe(){return{id:"",name:""}}const q={encode(t,e=u.Writer.create()){return t.id!==""&&e.uint32(10).string(t.id),t.name!==""&&e.uint32(18).string(t.name),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=fe();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.id=r.string();break;case 2:i.name=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{id:I(t.id)?String(t.id):"",name:I(t.name)?String(t.name):""}},toJSON(t){const e={};return t.id!==void 0&&(e.id=t.id),t.name!==void 0&&(e.name=t.name),e},fromPartial(t){var r,n;const e=fe();return e.id=(r=t.id)!=null?r:"",e.name=(n=t.name)!=null?n:"",e}};function ue(){return{connectedDevices:[]}}const Z={encode(t,e=u.Writer.create()){for(const r of t.connectedDevices)U.encode(r,e.uint32(18).fork()).ldelim();return e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ue();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 2:i.connectedDevices.push(U.decode(r,r.uint32()));break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{connectedDevices:Array.isArray(t==null?void 0:t.connectedDevices)?t.connectedDevices.map(e=>U.fromJSON(e)):[]}},toJSON(t){const e={};return t.connectedDevices?e.connectedDevices=t.connectedDevices.map(r=>r?U.toJSON(r):void 0):e.connectedDevices=[],e},fromPartial(t){var r;const e=ue();return e.connectedDevices=((r=t.connectedDevices)==null?void 0:r.map(n=>U.fromPartial(n)))||[],e}};function ve(){return{serverState:void 0,p2pMessage:void 0}}const Be={encode(t,e=u.Writer.create()){return t.serverState!==void 0&&Z.encode(t.serverState,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&N.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ve();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.serverState=Z.decode(r,r.uint32());break;case 2:i.p2pMessage=N.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{serverState:I(t.serverState)?Z.fromJSON(t.serverState):void 0,p2pMessage:I(t.p2pMessage)?N.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.serverState!==void 0&&(e.serverState=t.serverState?Z.toJSON(t.serverState):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?N.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=ve();return e.serverState=t.serverState!==void 0&&t.serverState!==null?Z.fromPartial(t.serverState):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?N.fromPartial(t.p2pMessage):void 0,e}};function pe(){return{senderUid:"",senderId:"",receiverId:"",initialRtcOffer:void 0,rtcOffer:void 0,rtcAnswer:void 0,iceCandidate:void 0}}const N={encode(t,e=u.Writer.create()){return t.senderUid!==""&&e.uint32(58).string(t.senderUid),t.senderId!==""&&e.uint32(10).string(t.senderId),t.receiverId!==""&&e.uint32(18).string(t.receiverId),t.initialRtcOffer!==void 0&&H.encode(t.initialRtcOffer,e.uint32(26).fork()).ldelim(),t.rtcOffer!==void 0&&W.encode(t.rtcOffer,e.uint32(34).fork()).ldelim(),t.rtcAnswer!==void 0&&L.encode(t.rtcAnswer,e.uint32(42).fork()).ldelim(),t.iceCandidate!==void 0&&z.encode(t.iceCandidate,e.uint32(50).fork()).ldelim(),e},decode(t,e){const r=t instanceof u.Reader?t:new u.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=pe();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 7:i.senderUid=r.string();break;case 1:i.senderId=r.string();break;case 2:i.receiverId=r.string();break;case 3:i.initialRtcOffer=H.decode(r,r.uint32());break;case 4:i.rtcOffer=W.decode(r,r.uint32());break;case 5:i.rtcAnswer=L.decode(r,r.uint32());break;case 6:i.iceCandidate=z.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{senderUid:I(t.senderUid)?String(t.senderUid):"",senderId:I(t.senderId)?String(t.senderId):"",receiverId:I(t.receiverId)?String(t.receiverId):"",initialRtcOffer:I(t.initialRtcOffer)?H.fromJSON(t.initialRtcOffer):void 0,rtcOffer:I(t.rtcOffer)?W.fromJSON(t.rtcOffer):void 0,rtcAnswer:I(t.rtcAnswer)?L.fromJSON(t.rtcAnswer):void 0,iceCandidate:I(t.iceCandidate)?z.fromJSON(t.iceCandidate):void 0}},toJSON(t){const e={};return t.senderUid!==void 0&&(e.senderUid=t.senderUid),t.senderId!==void 0&&(e.senderId=t.senderId),t.receiverId!==void 0&&(e.receiverId=t.receiverId),t.initialRtcOffer!==void 0&&(e.initialRtcOffer=t.initialRtcOffer?H.toJSON(t.initialRtcOffer):void 0),t.rtcOffer!==void 0&&(e.rtcOffer=t.rtcOffer?W.toJSON(t.rtcOffer):void 0),t.rtcAnswer!==void 0&&(e.rtcAnswer=t.rtcAnswer?L.toJSON(t.rtcAnswer):void 0),t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate?z.toJSON(t.iceCandidate):void 0),e},fromPartial(t){var r,n,i;const e=pe();return e.senderUid=(r=t.senderUid)!=null?r:"",e.senderId=(n=t.senderId)!=null?n:"",e.receiverId=(i=t.receiverId)!=null?i:"",e.initialRtcOffer=t.initialRtcOffer!==void 0&&t.initialRtcOffer!==null?H.fromPartial(t.initialRtcOffer):void 0,e.rtcOffer=t.rtcOffer!==void 0&&t.rtcOffer!==null?W.fromPartial(t.rtcOffer):void 0,e.rtcAnswer=t.rtcAnswer!==void 0&&t.rtcAnswer!==null?L.fromPartial(t.rtcAnswer):void 0,e.iceCandidate=t.iceCandidate!==void 0&&t.iceCandidate!==null?z.fromPartial(t.iceCandidate):void 0,e}};u.util.Long!==re&&(u.util.Long=re,u.configure());function I(t){return t!=null}function Ue(t){const{url:e,isDevice:r,clientId:n,token:i}=t;let a=new URL(e+"/events");a.searchParams.append("stream",n),a.searchParams.append("token",i);let o=e+"/command";const d=new ke(l=>{const v=new EventSource(a,{withCredentials:!1});return v.onmessage=s=>{l.closed||l.next(Be.decode(ne.Buffer.from(s.data,"base64")))},()=>v.close()}).pipe(ge({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}));return{sendCommand(l){fetch(o,{method:"POST",body:ne.Buffer.from(Ve.encode(l).finish()).toString("base64")})},onMessage(){return d}}}class He{constructor(e){this.robotService=e}async onIceCandidate(e,r,n){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,iceCandidate:{iceCandidate:JSON.stringify(n)}}})}async sendInitialOffer(e,r,n){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,initialRtcOffer:{offer:JSON.stringify(n)}}})}async sendAnswer(e,r,n){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,rtcAnswer:{answer:JSON.stringify(n)}}})}}class We{constructor(e){const{clientId:r,onMedia:n,peerId:i,rtcpHandler:a}=e;this.clientId=r,this.peerId=i,this.rtcpPeerConnection=new RTCPeerConnection,this.rtcpHandler=a,this.signalizationDataChannel=this.rtcpPeerConnection.createDataChannel("signalization",{id:0,ordered:!0}),this.rtcpPeerConnection.onicecandidate=o=>{this.rtcpHandler.onIceCandidate(this.clientId,i,o.candidate)},n({state:"notReady"}),this.rtcpPeerConnection.ontrack=o=>{o.track.onended=()=>{n({state:"notReady"})},o.track.readyState=="live"&&n({state:"ready",mediaStream:o.streams[0]})}}close(){this.rtcpPeerConnection.close()}async call(){const e=await this.rtcpPeerConnection.createOffer({offerToReceiveVideo:!0});await this.rtcpPeerConnection.setLocalDescription(e),await this.rtcpHandler.sendInitialOffer(this.clientId,this.peerId,e)}async receiveInitialOfferAndSendAnswer(e){await this.rtcpPeerConnection.setRemoteDescription(e);const r=await this.rtcpPeerConnection.createAnswer();await this.rtcpPeerConnection.setLocalDescription(r),this.rtcpHandler.sendAnswer(this.clientId,this.peerId,r)}async addIceCandidate(e){try{await this.rtcpPeerConnection.addIceCandidate(e)}catch(r){console.log(r)}}async receiveOffer(e){await this.rtcpPeerConnection.setRemoteDescription(e)}sendMessage(e){this.signalizationDataChannel.send(e)}}class Le{constructor(e){this.state=new Ie({type:"NotPeered"});const{onDevices:r,onMedia:n,clientId:i,signalingServerUrl:a,token:o}=e;this.clientId=i,this.onMedia=n;const d=Ue({url:a,isDevice:!1,clientId:this.clientId,token:o});this.rtcpHandler=new He(d),this.serverObservable=d.onMessage().pipe(_e(async l=>{var v;switch(!0){case l.p2pMessage!=null:{const s=l.p2pMessage,c=s.senderId;if(c!=((v=this.rtcPeerDecorator)==null?void 0:v.peerId))return;switch(!0){case s.initialRtcOffer!=null:{this.rtcPeerDecorator=this.createRTCPDecorator(c),await this.rtcPeerDecorator.receiveInitialOfferAndSendAnswer(JSON.parse(s.initialRtcOffer.offer));break}case s.iceCandidate!=null:{await this.rtcPeerDecorator.addIceCandidate(JSON.parse(s.iceCandidate.iceCandidate));break}case s.rtcOffer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(s.rtcOffer.offer));break}case s.rtcAnswer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(s.rtcAnswer.answer));break}}break}case l.serverState!=null:{const{connectedDevices:s}=l.serverState;r(s),s.find(c=>c.streamId!=this.clientId)||this.closeCurrentCall()}}return l}),ge({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}))}start(){this.subscription=this.serverObservable.subscribe()}stop(){var e;(e=this.subscription)==null||e.unsubscribe()}call(e){this.rtcPeerDecorator=this.createRTCPDecorator(e),this.rtcPeerDecorator.call(),this.state.next({type:"Peered",peerId:e})}sendMessage(e){var r;(r=this.rtcPeerDecorator)==null||r.sendMessage(e)}closeCurrentCall(){var e;(e=this.rtcPeerDecorator)==null||e.close(),this.rtcPeerDecorator=null,this.state.next({type:"NotPeered"})}createRTCPDecorator(e){return this.rtcPeerDecorator&&this.closeCurrentCall(),new We({clientId:this.clientId,onMedia:this.onMedia,peerId:e,rtcpHandler:this.rtcpHandler})}}function ze(t){let e,r,n;return{c(){e=w("div"),r=J("Video not available"),this.h()},l(i){e=O(i,"DIV",{class:!0});var a=_(e);r=A(a,"Video not available"),a.forEach(p),this.h()},h(){f(e,"class",n=`${t[2].class} bg-slate-200 text-lg`)},m(i,a){M(i,e,a),g(e,r)},p(i,a){a&4&&n!==(n=`${i[2].class} bg-slate-200 text-lg`)&&f(e,"class",n)},d(i){i&&p(e)}}}function qe(t){let e,r,n,i,a;return{c(){e=w("video"),r=w("track"),this.h()},l(o){e=O(o,"VIDEO",{class:!0});var d=_(e);r=O(d,"TRACK",{kind:!0}),d.forEach(p),this.h()},h(){f(r,"kind","captions"),e.autoplay=!0,f(e,"class",n=t[2].class)},m(o,d){M(o,e,d),g(e,r),i||(a=we(t[1].call(null,e)),i=!0)},p(o,d){d&4&&n!==(n=o[2].class)&&f(e,"class",n)},d(o){o&&p(e),i=!1,a()}}}function Ze(t){let e;function r(a,o){return a[0]&&a[0].state=="ready"?qe:ze}let n=r(t),i=n(t);return{c(){i.c(),e=ie()},l(a){i.l(a),e=ie()},m(a,o){i.m(a,o),M(a,e,o)},p(a,[o]){n===(n=r(a))&&i?i.p(a,o):(i.d(1),i=n(a),i&&(i.c(),i.m(e.parentNode,e)))},i:R,o:R,d(a){i.d(a),a&&p(e)}}}function Ke(t,e,r){let{mediaState:n}=e;function i(a){n&&n.state=="ready"&&(a.srcObject=n.mediaStream)}return t.$$set=a=>{r(2,e=Q(Q({},e),Y(a))),"mediaState"in a&&r(0,n=a.mediaState)},e=Y(e),[n,i,e]}class Xe extends K{constructor(e){super();X(this,e,Ke,Ze,F,{mediaState:0})}}function Fe(t){let e,r,n,i,a,o,d,l,v;return d=new Xe({props:{mediaState:t[1],class:"flex flex-grow place-content-center place-items-center bg-black rounded-2xl aspect-video h-96"}}),{c(){e=w("div"),r=w("div"),n=w("span"),i=J("Device Id"),a=J(t[0]),o=V(),$(d.$$.fragment),this.h()},l(s){e=O(s,"DIV",{class:!0});var c=_(e);r=O(c,"DIV",{class:!0});var m=_(r);n=O(m,"SPAN",{class:!0});var C=_(n);i=A(C,"Device Id"),C.forEach(p),a=A(m,t[0]),m.forEach(p),o=B(c),x(d.$$.fragment,c),c.forEach(p),this.h()},h(){f(n,"class","bg-light-gray text-bluestrong text-sm font-medium mr-2 px-2.5 py-0.5 rounded"),f(r,"class","my-3"),f(e,"class",l=t[2].class)},m(s,c){M(s,e,c),g(e,r),g(r,n),g(n,i),g(r,a),g(e,o),T(d,e,null),v=!0},p(s,[c]){(!v||c&1)&&Se(a,s[0]);const m={};c&2&&(m.mediaState=s[1]),d.$set(m),(!v||c&4&&l!==(l=s[2].class))&&f(e,"class",l)},i(s){v||(D(d.$$.fragment,s),v=!0)},o(s){P(d.$$.fragment,s),v=!1},d(s){s&&p(e),E(d)}}}function Ge(t,e,r){let{peerId:n}=e,{mediaState:i}=e;return t.$$set=a=>{r(2,e=Q(Q({},e),Y(a))),"peerId"in a&&r(0,n=a.peerId),"mediaState"in a&&r(1,i=a.mediaState)},e=Y(e),[n,i,e]}class Qe extends K{constructor(e){super();X(this,e,Ge,Fe,F,{peerId:0,mediaState:1})}}function he(t,e,r){const n=t.slice();return n[4]=e[r],n}function Ye(t){let e,r;return{c(){e=j("svg"),r=j("path"),this.h()},l(n){e=ee(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=ee(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(p),i.forEach(p),this.h()},h(){f(r,"stroke-linecap","round"),f(r,"stroke-linejoin","round"),f(r,"stroke-width","2"),f(r,"d","M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"class","h-6 w-6 mr-2"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke","currentColor")},m(n,i){M(n,e,i),g(e,r)},d(n){n&&p(e)}}}function je(t){let e,r;return{c(){e=j("svg"),r=j("path"),this.h()},l(n){e=ee(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=ee(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(p),i.forEach(p),this.h()},h(){f(r,"stroke-linecap","round"),f(r,"stroke-linejoin","round"),f(r,"stroke-width","2"),f(r,"d","M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"),f(e,"xmlns","http://www.w3.org/2000/svg"),f(e,"class","h-6 w-6 mr-2"),f(e,"fill","none"),f(e,"viewBox","0 0 24 24"),f(e,"stroke","currentColor")},m(n,i){M(n,e,i),g(e,r)},d(n){n&&p(e)}}}function me(t,e){let r,n,i,a,o=e[4].streamId+"",d,l,v,s,c;function m(h,k){return h[4].isMobile?je:Ye}let C=m(e),S=C(e);function G(){return e[3](e[4])}return{key:t,first:null,c(){r=w("div"),n=w("div"),S.c(),i=V(),a=w("div"),d=J(o),v=V(),this.h()},l(h){r=O(h,"DIV",{class:!0});var k=_(r);n=O(k,"DIV",{class:!0});var b=_(n);S.l(b),i=B(b),a=O(b,"DIV",{});var y=_(a);d=A(y,o),y.forEach(p),b.forEach(p),v=B(k),k.forEach(p),this.h()},h(){f(n,"class",l="flex flex-row rounded-lg p-1 "+(e[2]==e[4].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400"),f(r,"class","box-border my-2 px-3"),this.first=r},m(h,k){M(h,r,k),g(r,n),S.m(n,null),g(n,i),g(n,a),g(a,d),g(r,v),s||(c=Oe(n,"click",G),s=!0)},p(h,k){e=h,C!==(C=m(e))&&(S.d(1),S=C(e),S&&(S.c(),S.m(n,i))),k&1&&o!==(o=e[4].streamId+"")&&Se(d,o),k&5&&l!==(l="flex flex-row rounded-lg p-1 "+(e[2]==e[4].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400")&&f(n,"class",l)},d(h){h&&p(r),S.d(),s=!1,c()}}}function et(t){let e,r,n,i,a,o=[],d=new Map,l=t[0];const v=s=>s[4].streamId;for(let s=0;s<l.length;s+=1){let c=he(t,l,s),m=v(c);d.set(m,o[s]=me(m,c))}return{c(){e=w("div"),r=w("div"),n=J("Available devices"),i=V(),a=w("div");for(let s=0;s<o.length;s+=1)o[s].c();this.h()},l(s){e=O(s,"DIV",{class:!0});var c=_(e);r=O(c,"DIV",{class:!0});var m=_(r);n=A(m,"Available devices"),m.forEach(p),c.forEach(p),i=B(s),a=O(s,"DIV",{class:!0});var C=_(a);for(let S=0;S<o.length;S+=1)o[S].l(C);C.forEach(p),this.h()},h(){f(r,"class","text-center text-gray"),f(e,"class","w-full shadow-sm py-2"),f(a,"class","overflow-y-scroll")},m(s,c){M(s,e,c),g(e,r),g(r,n),M(s,i,c),M(s,a,c);for(let m=0;m<o.length;m+=1)o[m].m(a,null)},p(s,[c]){c&7&&(l=s[0],o=Ce(o,c,v,1,s,l,d,a,be,me,null,he))},i:R,o:R,d(s){s&&p(e),s&&p(i),s&&p(a);for(let c=0;c<o.length;c+=1)o[c].d()}}}function tt(t,e,r){let{devices:n}=e,{selectDevice:i}=e,a="";const o=d=>{r(2,a=d.streamId),i(d.streamId)};return t.$$set=d=>{"devices"in d&&r(0,n=d.devices),"selectDevice"in d&&r(1,i=d.selectDevice)},[n,i,a,o]}class rt extends K{constructor(e){super();X(this,e,tt,et,F,{devices:0,selectDevice:1})}}function nt(t){let e,r;return e=new xe({props:{slot:"topbar"}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p:R,i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}function it(t){let e,r;return{c(){e=w("div"),r=J("Select a device"),this.h()},l(n){e=O(n,"DIV",{class:!0});var i=_(e);r=A(i,"Select a device"),i.forEach(p),this.h()},h(){f(e,"class","flex flex-grow place-items-center place-content-center text-xl text-gray")},m(n,i){M(n,e,i),g(e,r)},p:R,i:R,o:R,d(n){n&&p(e)}}}function at(t){let e,r;return e=new Qe({props:{class:"flex flex-grow flex-col shadow-lg p-4 border-2 border-gray-100 rounded-lg",peerId:t[2].peerId,mediaState:t[1]}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p(n,i){const a={};i&4&&(a.peerId=n[2].peerId),i&2&&(a.mediaState=n[1]),e.$set(a)},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}function st(t){let e,r,n,i,a,o,d,l,v,s,c,m;const C=[at,it],S=[];function G(h,k){return h[2]&&h[2].type=="Peered"?0:1}return d=G(t),l=S[d]=C[d](t),c=new rt({props:{selectDevice:t[6],devices:t[0]}}),{c(){e=w("div"),r=w("div"),n=w("div"),i=J("Control center for device: "),a=J(t[4]),o=V(),l.c(),v=V(),s=w("div"),$(c.$$.fragment),this.h()},l(h){e=O(h,"DIV",{slot:!0,class:!0});var k=_(e);r=O(k,"DIV",{class:!0});var b=_(r);n=O(b,"DIV",{class:!0});var y=_(n);i=A(y,"Control center for device: "),a=A(y,t[4]),y.forEach(p),o=B(b),l.l(b),b.forEach(p),v=B(k),s=O(k,"DIV",{class:!0});var te=_(s);x(c.$$.fragment,te),te.forEach(p),k.forEach(p),this.h()},h(){f(n,"class","textxl text-gray"),f(r,"class","flex flex-grow flex-col m-5"),f(s,"class","flex flex-col flex-grow max-w-md shadow-md"),f(e,"slot","main"),f(e,"class","flex flex-row flex-grow")},m(h,k){M(h,e,k),g(e,r),g(r,n),g(n,i),g(n,a),g(r,o),S[d].m(r,null),g(e,v),g(e,s),T(c,s,null),m=!0},p(h,k){let b=d;d=G(h),d===b?S[d].p(h,k):(Pe(),P(S[b],1,1,()=>{S[b]=null}),Re(),l=S[d],l?l.p(h,k):(l=S[d]=C[d](h),l.c()),D(l,1),l.m(r,null));const y={};k&8&&(y.selectDevice=h[6]),k&1&&(y.devices=h[0]),c.$set(y)},i(h){m||(D(l),D(c.$$.fragment,h),m=!0)},o(h){P(l),P(c.$$.fragment,h),m=!1},d(h){h&&p(e),S[d].d(),E(c)}}}function ot(t){let e,r;return e=new Ae({props:{$$slots:{main:[st],topbar:[nt]},$$scope:{ctx:t}}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p(n,[i]){const a={};i&271&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}function ct(t,e,r){let n,i;Me(t,$e,c=>r(5,i=c));let a=ye(),o=[],d,l,v;Ne(async()=>{n.type=="LoggedIn"&&(r(3,v=new Le({clientId:a,onDevices:c=>{r(0,o=c.filter(m=>m.streamId!=a))},onMedia:c=>{r(1,d=c)},signalingServerUrl:Te.robotService.url,token:await n.user.getIdToken()})),v.start(),v.state.subscribe({next:c=>{r(2,l=c)}}))}),De(()=>{v==null||v.stop()});const s=c=>{v.call(c)};return t.$$.update=()=>{t.$$.dirty&32&&(n=i.authState)},[o,d,l,v,a,i,s]}class dt extends K{constructor(e){super();X(this,e,ct,ot,F,{})}}function lt(t){let e,r;return e=new dt({}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}function ft(t){let e,r;return e=new Je({props:{denyIfNotAuthenticated:!0,$$slots:{default:[lt]},$$scope:{ctx:t}}}),{c(){$(e.$$.fragment)},l(n){x(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p(n,[i]){const a={};i&1&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){P(e.$$.fragment,n),r=!1},d(n){E(e,n)}}}class gt extends K{constructor(e){super();X(this,e,null,ft,F,{})}}export{gt as default};
