var Ee=Object.defineProperty,Je=Object.defineProperties;var Te=Object.getOwnPropertyDescriptors;var ue=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,xe=Object.prototype.propertyIsEnumerable;var ve=(t,e,r)=>e in t?Ee(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,H=(t,e)=>{for(var r in e||(e={}))Be.call(e,r)&&ve(t,r,e[r]);if(ue)for(var r of ue(e))xe.call(e,r)&&ve(t,r,e[r]);return t},L=(t,e)=>Je(t,Te(e));import{a4 as g,a5 as he,a6 as me,a7 as Ue,a8 as Ne,a9 as Ke,aa as Ve,S as X,i as Z,s as G,J as He,e as I,c as O,a as _,d as h,b as o,g as y,a1 as Y,K as Le,L as We,M as Fe,q as D,o as R,a2 as Pe,ab as z,k as N,w as E,m as P,x as J,H as w,y as T,B,N as x,O as U,ac as ze,ad as qe,ae as Xe,af as Ze,ag as Ge,l as pe,I as q,C as de,P as ce,t as W,h as F,ah as Qe,j as Ae,ai as Ye,aj as je,_ as et,ak as tt,v as rt,al as nt,n as it,p as at}from"../../../chunks/vendor-0fbb5e6e.js";import{S as st}from"../../../chunks/SecurityCheckPage-9a18eeec.js";import{P as ot,S as dt,a as ct,e as lt}from"../../../chunks/StandardTopBar-6a2f7bbf.js";/* empty css                          */import"../../../chunks/singletons-d1fb5791.js";function we(){return{uid:"",streamId:"",name:"",isMobile:!1}}const j={encode(t,e=g.Writer.create()){return t.uid!==""&&e.uint32(34).string(t.uid),t.streamId!==""&&e.uint32(10).string(t.streamId),t.name!==""&&e.uint32(18).string(t.name),t.isMobile===!0&&e.uint32(24).bool(t.isMobile),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=we();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 4:i.uid=r.string();break;case 1:i.streamId=r.string();break;case 2:i.name=r.string();break;case 3:i.isMobile=r.bool();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{uid:C(t.uid)?String(t.uid):"",streamId:C(t.streamId)?String(t.streamId):"",name:C(t.name)?String(t.name):"",isMobile:C(t.isMobile)?Boolean(t.isMobile):!1}},toJSON(t){const e={};return t.uid!==void 0&&(e.uid=t.uid),t.streamId!==void 0&&(e.streamId=t.streamId),t.name!==void 0&&(e.name=t.name),t.isMobile!==void 0&&(e.isMobile=t.isMobile),e},fromPartial(t){var r,n,i,a;const e=we();return e.uid=(r=t.uid)!=null?r:"",e.streamId=(n=t.streamId)!=null?n:"",e.name=(i=t.name)!=null?i:"",e.isMobile=(a=t.isMobile)!=null?a:!1,e}};function ge(){return{offer:""}}const ee={encode(t,e=g.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ge();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:C(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=ge();return e.offer=(r=t.offer)!=null?r:"",e}};function ke(){return{offer:""}}const te={encode(t,e=g.Writer.create()){return t.offer!==""&&e.uint32(26).string(t.offer),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ke();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.offer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{offer:C(t.offer)?String(t.offer):""}},toJSON(t){const e={};return t.offer!==void 0&&(e.offer=t.offer),e},fromPartial(t){var r;const e=ke();return e.offer=(r=t.offer)!=null?r:"",e}};function _e(){return{answer:""}}const re={encode(t,e=g.Writer.create()){return t.answer!==""&&e.uint32(26).string(t.answer),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=_e();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.answer=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{answer:C(t.answer)?String(t.answer):""}},toJSON(t){const e={};return t.answer!==void 0&&(e.answer=t.answer),e},fromPartial(t){var r;const e=_e();return e.answer=(r=t.answer)!=null?r:"",e}};function Se(){return{iceCandidate:""}}const ne={encode(t,e=g.Writer.create()){return t.iceCandidate!==""&&e.uint32(26).string(t.iceCandidate),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Se();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 3:i.iceCandidate=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{iceCandidate:C(t.iceCandidate)?String(t.iceCandidate):""}},toJSON(t){const e={};return t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate),e},fromPartial(t){var r;const e=Se();return e.iceCandidate=(r=t.iceCandidate)!=null?r:"",e}};function be(){return{setName:void 0,p2pMessage:void 0}}const ft={encode(t,e=g.Writer.create()){return t.setName!==void 0&&ie.encode(t.setName,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&K.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=be();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.setName=ie.decode(r,r.uint32());break;case 2:i.p2pMessage=K.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{setName:C(t.setName)?ie.fromJSON(t.setName):void 0,p2pMessage:C(t.p2pMessage)?K.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.setName!==void 0&&(e.setName=t.setName?ie.toJSON(t.setName):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?K.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=be();return e.setName=t.setName!==void 0&&t.setName!==null?ie.fromPartial(t.setName):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?K.fromPartial(t.p2pMessage):void 0,e}};function Ce(){return{id:"",name:""}}const ie={encode(t,e=g.Writer.create()){return t.id!==""&&e.uint32(10).string(t.id),t.name!==""&&e.uint32(18).string(t.name),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Ce();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.id=r.string();break;case 2:i.name=r.string();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{id:C(t.id)?String(t.id):"",name:C(t.name)?String(t.name):""}},toJSON(t){const e={};return t.id!==void 0&&(e.id=t.id),t.name!==void 0&&(e.name=t.name),e},fromPartial(t){var r,n;const e=Ce();return e.id=(r=t.id)!=null?r:"",e.name=(n=t.name)!=null?n:"",e}};function Ie(){return{connectedDevices:[]}}const ae={encode(t,e=g.Writer.create()){for(const r of t.connectedDevices)j.encode(r,e.uint32(18).fork()).ldelim();return e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Ie();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 2:i.connectedDevices.push(j.decode(r,r.uint32()));break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{connectedDevices:Array.isArray(t==null?void 0:t.connectedDevices)?t.connectedDevices.map(e=>j.fromJSON(e)):[]}},toJSON(t){const e={};return t.connectedDevices?e.connectedDevices=t.connectedDevices.map(r=>r?j.toJSON(r):void 0):e.connectedDevices=[],e},fromPartial(t){var r;const e=Ie();return e.connectedDevices=((r=t.connectedDevices)==null?void 0:r.map(n=>j.fromPartial(n)))||[],e}};function Oe(){return{serverState:void 0,p2pMessage:void 0}}const ut={encode(t,e=g.Writer.create()){return t.serverState!==void 0&&ae.encode(t.serverState,e.uint32(10).fork()).ldelim(),t.p2pMessage!==void 0&&K.encode(t.p2pMessage,e.uint32(18).fork()).ldelim(),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Oe();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.serverState=ae.decode(r,r.uint32());break;case 2:i.p2pMessage=K.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{serverState:C(t.serverState)?ae.fromJSON(t.serverState):void 0,p2pMessage:C(t.p2pMessage)?K.fromJSON(t.p2pMessage):void 0}},toJSON(t){const e={};return t.serverState!==void 0&&(e.serverState=t.serverState?ae.toJSON(t.serverState):void 0),t.p2pMessage!==void 0&&(e.p2pMessage=t.p2pMessage?K.toJSON(t.p2pMessage):void 0),e},fromPartial(t){const e=Oe();return e.serverState=t.serverState!==void 0&&t.serverState!==null?ae.fromPartial(t.serverState):void 0,e.p2pMessage=t.p2pMessage!==void 0&&t.p2pMessage!==null?K.fromPartial(t.p2pMessage):void 0,e}};function ye(){return{senderId:"",receiverId:"",senderUid:"",rtcOffer:void 0,rtcAnswer:void 0,iceCandidate:void 0,initialRtcOffer:void 0}}const K={encode(t,e=g.Writer.create()){return t.senderId!==""&&e.uint32(10).string(t.senderId),t.receiverId!==""&&e.uint32(18).string(t.receiverId),t.senderUid!==""&&e.uint32(26).string(t.senderUid),t.rtcOffer!==void 0&&te.encode(t.rtcOffer,e.uint32(34).fork()).ldelim(),t.rtcAnswer!==void 0&&re.encode(t.rtcAnswer,e.uint32(42).fork()).ldelim(),t.iceCandidate!==void 0&&ne.encode(t.iceCandidate,e.uint32(50).fork()).ldelim(),t.initialRtcOffer!==void 0&&ee.encode(t.initialRtcOffer,e.uint32(58).fork()).ldelim(),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=ye();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.senderId=r.string();break;case 2:i.receiverId=r.string();break;case 3:i.senderUid=r.string();break;case 4:i.rtcOffer=te.decode(r,r.uint32());break;case 5:i.rtcAnswer=re.decode(r,r.uint32());break;case 6:i.iceCandidate=ne.decode(r,r.uint32());break;case 7:i.initialRtcOffer=ee.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{senderId:C(t.senderId)?String(t.senderId):"",receiverId:C(t.receiverId)?String(t.receiverId):"",senderUid:C(t.senderUid)?String(t.senderUid):"",rtcOffer:C(t.rtcOffer)?te.fromJSON(t.rtcOffer):void 0,rtcAnswer:C(t.rtcAnswer)?re.fromJSON(t.rtcAnswer):void 0,iceCandidate:C(t.iceCandidate)?ne.fromJSON(t.iceCandidate):void 0,initialRtcOffer:C(t.initialRtcOffer)?ee.fromJSON(t.initialRtcOffer):void 0}},toJSON(t){const e={};return t.senderId!==void 0&&(e.senderId=t.senderId),t.receiverId!==void 0&&(e.receiverId=t.receiverId),t.senderUid!==void 0&&(e.senderUid=t.senderUid),t.rtcOffer!==void 0&&(e.rtcOffer=t.rtcOffer?te.toJSON(t.rtcOffer):void 0),t.rtcAnswer!==void 0&&(e.rtcAnswer=t.rtcAnswer?re.toJSON(t.rtcAnswer):void 0),t.iceCandidate!==void 0&&(e.iceCandidate=t.iceCandidate?ne.toJSON(t.iceCandidate):void 0),t.initialRtcOffer!==void 0&&(e.initialRtcOffer=t.initialRtcOffer?ee.toJSON(t.initialRtcOffer):void 0),e},fromPartial(t){var r,n,i;const e=ye();return e.senderId=(r=t.senderId)!=null?r:"",e.receiverId=(n=t.receiverId)!=null?n:"",e.senderUid=(i=t.senderUid)!=null?i:"",e.rtcOffer=t.rtcOffer!==void 0&&t.rtcOffer!==null?te.fromPartial(t.rtcOffer):void 0,e.rtcAnswer=t.rtcAnswer!==void 0&&t.rtcAnswer!==null?re.fromPartial(t.rtcAnswer):void 0,e.iceCandidate=t.iceCandidate!==void 0&&t.iceCandidate!==null?ne.fromPartial(t.iceCandidate):void 0,e.initialRtcOffer=t.initialRtcOffer!==void 0&&t.initialRtcOffer!==null?ee.fromPartial(t.initialRtcOffer):void 0,e}};function De(){return{forward:0,right:0}}const se={encode(t,e=g.Writer.create()){return t.forward!==0&&e.uint32(8).int32(t.forward),t.right!==0&&e.uint32(16).int32(t.right),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=De();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.forward=r.int32();break;case 2:i.right=r.int32();break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{forward:C(t.forward)?Number(t.forward):0,right:C(t.right)?Number(t.right):0}},toJSON(t){const e={};return t.forward!==void 0&&(e.forward=Math.round(t.forward)),t.right!==void 0&&(e.right=Math.round(t.right)),e},fromPartial(t){var r,n;const e=De();return e.forward=(r=t.forward)!=null?r:0,e.right=(n=t.right)!=null?n:0,e}};function Re(){return{directionCommand:void 0}}const vt={encode(t,e=g.Writer.create()){return t.directionCommand!==void 0&&se.encode(t.directionCommand,e.uint32(10).fork()).ldelim(),e},decode(t,e){const r=t instanceof g.Reader?t:new g.Reader(t);let n=e===void 0?r.len:r.pos+e;const i=Re();for(;r.pos<n;){const a=r.uint32();switch(a>>>3){case 1:i.directionCommand=se.decode(r,r.uint32());break;default:r.skipType(a&7);break}}return i},fromJSON(t){return{directionCommand:C(t.directionCommand)?se.fromJSON(t.directionCommand):void 0}},toJSON(t){const e={};return t.directionCommand!==void 0&&(e.directionCommand=t.directionCommand?se.toJSON(t.directionCommand):void 0),e},fromPartial(t){const e=Re();return e.directionCommand=t.directionCommand!==void 0&&t.directionCommand!==null?se.fromPartial(t.directionCommand):void 0,e}};g.util.Long!==he&&(g.util.Long=he,g.configure());function C(t){return t!=null}function ht(t){const{url:e,isDevice:r,clientId:n,token:i}=t,a=new URL(e+"/events");a.searchParams.append("stream",n),a.searchParams.append("token",i);const l=new URL(e+"/command");l.searchParams.append("token",i);const d=new Ue(s=>{const f=new EventSource(a,{withCredentials:!1});return f.onmessage=c=>{s.closed||s.next(ut.decode(me.Buffer.from(c.data,"base64")))},()=>f.close()}).pipe(Ne({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}));return{sendCommand(s){fetch(l.toString(),{method:"POST",body:me.Buffer.from(ft.encode(s).finish()).toString("base64")})},onMessage(){return d},closeStream(){fetch(l.toString(),{method:"DELETE"})},closeDeviceStream(s){const f=new URL(e+"/events");f.searchParams.append("stream",s),f.searchParams.append("token",i),fetch(f.toString(),{method:"DELETE"})}}}class mt{constructor(e){this.robotService=e}async onIceCandidate(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,iceCandidate:{iceCandidate:JSON.stringify(i)}}})}async sendInitialOffer(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,initialRtcOffer:{offer:JSON.stringify(i)}}})}async sendAnswer(e,r,n,i){this.robotService.sendCommand({p2pMessage:{senderId:e,receiverId:r,senderUid:n,rtcAnswer:{answer:JSON.stringify(i)}}})}}class pt{constructor(e){const{clientId:r,onMedia:n,peerId:i,uid:a,rtcpHandler:l}=e;this.clientId=r,this.peerId=i,this.uid=a,this.rtcpPeerConnection=new RTCPeerConnection,this.rtcpHandler=l,this.signalizationDataChannel=this.rtcpPeerConnection.createDataChannel("signalization",{id:0,ordered:!0}),this.rtcpPeerConnection.onicecandidate=d=>{this.rtcpHandler.onIceCandidate(this.clientId,i,this.uid,d.candidate)},n({state:"notReady"}),this.rtcpPeerConnection.ontrack=d=>{d.track.onended=()=>{n({state:"notReady"})},d.track.readyState=="live"&&n({state:"ready",mediaStream:d.streams[0]})}}close(){this.rtcpPeerConnection.close()}async call(){const e=await this.rtcpPeerConnection.createOffer({offerToReceiveVideo:!0});await this.rtcpPeerConnection.setLocalDescription(e),await this.rtcpHandler.sendInitialOffer(this.clientId,this.peerId,this.uid,e)}async receiveInitialOfferAndSendAnswer(e){await this.rtcpPeerConnection.setRemoteDescription(e);const r=await this.rtcpPeerConnection.createAnswer();await this.rtcpPeerConnection.setLocalDescription(r),this.rtcpHandler.sendAnswer(this.clientId,this.peerId,this.uid,r)}async addIceCandidate(e){try{await this.rtcpPeerConnection.addIceCandidate(e)}catch(r){console.log(r)}}async receiveOffer(e){await this.rtcpPeerConnection.setRemoteDescription(e)}sendMessage(e){this.signalizationDataChannel.send(e)}}class wt{constructor(e){this.state=new Ke({type:"NotPeered"});const{onDevices:r,onMedia:n,clientId:i,signalingServerUrl:a,token:l,uid:d}=e;this.clientId=i,this.onMedia=n,this.uid=d,this.robotService=ht({url:a,isDevice:!1,clientId:this.clientId,token:l}),this.rtcpHandler=new mt(this.robotService),this.serverObservable=this.robotService.onMessage().pipe(Ve(async s=>{var f;switch(!0){case s.p2pMessage!=null:{const c=s.p2pMessage,m=c.senderId;if(m!=((f=this.rtcPeerDecorator)==null?void 0:f.peerId))return;switch(!0){case c.initialRtcOffer!=null:{this.rtcPeerDecorator=this.createRTCPDecorator(m),await this.rtcPeerDecorator.receiveInitialOfferAndSendAnswer(JSON.parse(c.initialRtcOffer.offer));break}case c.iceCandidate!=null:{await this.rtcPeerDecorator.addIceCandidate(JSON.parse(c.iceCandidate.iceCandidate));break}case c.rtcOffer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(c.rtcOffer.offer));break}case c.rtcAnswer!=null:{await this.rtcPeerDecorator.receiveOffer(JSON.parse(c.rtcAnswer.answer));break}}break}case s.serverState!=null:{const{connectedDevices:c}=s.serverState;r(c),c.find(m=>m.streamId!=this.clientId)||this.closeCurrentCall()}}return s}),Ne({resetOnError:!1,resetOnComplete:!1,resetOnRefCountZero:!0}))}closeStream(){this.robotService.closeStream()}closeDeviceStream(e){this.robotService.closeDeviceStream(e)}start(){this.subscription=this.serverObservable.subscribe()}stop(){var e;(e=this.subscription)==null||e.unsubscribe()}call(e){this.rtcPeerDecorator=this.createRTCPDecorator(e),this.rtcPeerDecorator.call(),this.state.next({type:"Peered",peerId:e})}sendMessage(e){var r;(r=this.rtcPeerDecorator)==null||r.sendMessage(e)}closeCurrentCall(){var e;(e=this.rtcPeerDecorator)==null||e.close(),this.rtcPeerDecorator=null,this.state.next({type:"NotPeered"})}createRTCPDecorator(e){return this.rtcPeerDecorator&&this.closeCurrentCall(),new pt({clientId:this.clientId,uid:this.uid,onMedia:this.onMedia,peerId:e,rtcpHandler:this.rtcpHandler})}}function gt(t){let e,r,n,i,a;const l=t[5].default,d=He(l,t,t[4],null);return{c(){e=I("div"),d&&d.c(),this.h()},l(s){e=O(s,"DIV",{class:!0});var f=_(e);d&&d.l(f),f.forEach(h),this.h()},h(){o(e,"class",r="flex flex-row place-items-center place-content-center border-2 border-emerald-500 rounded-xl "+(t[1]?"bg-bluemiddle":"bg-bluelight"))},m(s,f){y(s,e,f),d&&d.m(e,null),n=!0,i||(a=[Y(window,"keydown",t[6]),Y(window,"keyup",t[7]),Y(e,"mousedown",t[8]),Y(e,"mouseup",t[9])],i=!0)},p(s,[f]){d&&d.p&&(!n||f&16)&&Le(d,l,s,s[4],n?Fe(l,s[4],f,null):We(s[4]),null),(!n||f&2&&r!==(r="flex flex-row place-items-center place-content-center border-2 border-emerald-500 rounded-xl "+(s[1]?"bg-bluemiddle":"bg-bluelight")))&&o(e,"class",r)},i(s){n||(D(d,s),n=!0)},o(s){R(d,s),n=!1},d(s){s&&h(e),d&&d.d(s),i=!1,Pe(a)}}}function kt(t,e,r){let{$$slots:n={},$$scope:i}=e,{key:a}=e,{directionEventHandler:l}=e,d=!1;function s(u){r(1,d=u),l(u?{eventType:"KeyDown",direction:a}:{eventType:"KeyReleased",direction:a})}const f=u=>{u.metaKey||u.ctrlKey||u.shiftKey||u.key==a&&(s(!0),u.preventDefault())},c=u=>{u.metaKey||u.ctrlKey||u.shiftKey||u.key==a&&(s(!1),u.preventDefault())},m=()=>s(!0),k=()=>s(!1);return t.$$set=u=>{"key"in u&&r(0,a=u.key),"directionEventHandler"in u&&r(3,l=u.directionEventHandler),"$$scope"in u&&r(4,i=u.$$scope)},[a,d,s,l,i,n,f,c,m,k]}class oe extends X{constructor(e){super();Z(this,e,kt,gt,G,{key:0,directionEventHandler:3})}}function _t(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=U(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(h),i.forEach(h),this.h()},h(){o(r,"stroke-linecap","round"),o(r,"stroke-linejoin","round"),o(r,"stroke-width","2"),o(r,"d","M5 15l7-7 7 7"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-6 w-6"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(n,i){y(n,e,i),w(e,r)},d(n){n&&h(e)}}}function St(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=U(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(h),i.forEach(h),this.h()},h(){o(r,"stroke-linecap","round"),o(r,"stroke-linejoin","round"),o(r,"stroke-width","2"),o(r,"d","M15 19l-7-7 7-7"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-6 w-6"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(n,i){y(n,e,i),w(e,r)},d(n){n&&h(e)}}}function bt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=U(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(h),i.forEach(h),this.h()},h(){o(r,"stroke-linecap","round"),o(r,"stroke-linejoin","round"),o(r,"stroke-width","2"),o(r,"d","M19 9l-7 7-7-7"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-6 w-6"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(n,i){y(n,e,i),w(e,r)},d(n){n&&h(e)}}}function Ct(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=U(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(h),i.forEach(h),this.h()},h(){o(r,"stroke-linecap","round"),o(r,"stroke-linejoin","round"),o(r,"stroke-width","2"),o(r,"d","M9 5l7 7-7 7"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-6 w-6"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(n,i){y(n,e,i),w(e,r)},d(n){n&&h(e)}}}function It(t){let e,r,n,i,a,l,d,s,f,c,m,k,u;return i=new oe({props:{key:z.Key.ArrowUp,directionEventHandler:t[0],$$slots:{default:[_t]},$$scope:{ctx:t}}}),s=new oe({props:{key:z.Key.ArrowLeft,directionEventHandler:t[0],$$slots:{default:[St]},$$scope:{ctx:t}}}),c=new oe({props:{key:z.Key.ArrowDown,directionEventHandler:t[0],$$slots:{default:[bt]},$$scope:{ctx:t}}}),k=new oe({props:{key:z.Key.ArrowRight,directionEventHandler:t[0],$$slots:{default:[Ct]},$$scope:{ctx:t}}}),{c(){e=I("div"),r=I("div"),n=N(),E(i.$$.fragment),a=N(),l=I("div"),d=N(),E(s.$$.fragment),f=N(),E(c.$$.fragment),m=N(),E(k.$$.fragment),this.h()},l(v){e=O(v,"DIV",{class:!0});var p=_(e);r=O(p,"DIV",{}),_(r).forEach(h),n=P(p),J(i.$$.fragment,p),a=P(p),l=O(p,"DIV",{}),_(l).forEach(h),d=P(p),J(s.$$.fragment,p),f=P(p),J(c.$$.fragment,p),m=P(p),J(k.$$.fragment,p),p.forEach(h),this.h()},h(){o(e,"class","grid grid-cols-3 grid-rows-2 w-64 h-24 gap-1 bg-slate-200 p-2 rounded-2xl border-2 border-slate-300")},m(v,p){y(v,e,p),w(e,r),w(e,n),T(i,e,null),w(e,a),w(e,l),w(e,d),T(s,e,null),w(e,f),T(c,e,null),w(e,m),T(k,e,null),u=!0},p(v,[p]){const S={};p&1&&(S.directionEventHandler=v[0]),p&2&&(S.$$scope={dirty:p,ctx:v}),i.$set(S);const b={};p&1&&(b.directionEventHandler=v[0]),p&2&&(b.$$scope={dirty:p,ctx:v}),s.$set(b);const $={};p&1&&($.directionEventHandler=v[0]),p&2&&($.$$scope={dirty:p,ctx:v}),c.$set($);const M={};p&1&&(M.directionEventHandler=v[0]),p&2&&(M.$$scope={dirty:p,ctx:v}),k.$set(M)},i(v){u||(D(i.$$.fragment,v),D(s.$$.fragment,v),D(c.$$.fragment,v),D(k.$$.fragment,v),u=!0)},o(v){R(i.$$.fragment,v),R(s.$$.fragment,v),R(c.$$.fragment,v),R(k.$$.fragment,v),u=!1},d(v){v&&h(e),B(i),B(s),B(c),B(k)}}}function Ot(t,e,r){let{directionFn:n}=e;return t.$$set=i=>{"directionFn"in i&&r(0,n=i.directionFn)},[n]}class yt extends X{constructor(e){super();Z(this,e,Ot,It,G,{directionFn:0})}}function Dt(t){const e=new ze;return e.pipe(qe((r,n)=>{switch(n.direction){case z.Key.ArrowUp:switch(n.eventType){case"KeyDown":return L(H({},r),{ArrowUp:1});case"KeyReleased":return L(H({},r),{ArrowUp:0})}case z.Key.ArrowDown:switch(n.eventType){case"KeyDown":return L(H({},r),{ArrowDown:1});case"KeyReleased":return L(H({},r),{ArrowDown:0})}case z.Key.ArrowLeft:switch(n.eventType){case"KeyDown":return L(H({},r),{ArrowLeft:1});case"KeyReleased":return L(H({},r),{ArrowLeft:0})}case z.Key.ArrowRight:switch(n.eventType){case"KeyDown":return L(H({},r),{ArrowRight:1});case"KeyReleased":return L(H({},r),{ArrowRight:0})}}},{ArrowUp:0,ArrowDown:0,ArrowRight:0,ArrowLeft:0}),Xe(r=>({directionCommand:{forward:(r.ArrowUp-r.ArrowDown)*100,right:(r.ArrowRight-r.ArrowLeft)*100}})),Ze(300,Ge,{trailing:!0,leading:!1})).subscribe({next:r=>{t(r)}}),r=>{e.next(r)}}function Rt(t){let e,r,n;return{c(){e=I("div"),r=W("Video not available"),this.h()},l(i){e=O(i,"DIV",{class:!0});var a=_(e);r=F(a,"Video not available"),a.forEach(h),this.h()},h(){o(e,"class",n=`${t[2].class} bg-slate-200 text-lg`)},m(i,a){y(i,e,a),w(e,r)},p(i,a){a&4&&n!==(n=`${i[2].class} bg-slate-200 text-lg`)&&o(e,"class",n)},d(i){i&&h(e)}}}function $t(t){let e,r,n,i,a;return{c(){e=I("video"),r=I("track"),this.h()},l(l){e=O(l,"VIDEO",{class:!0});var d=_(e);r=O(d,"TRACK",{kind:!0}),d.forEach(h),this.h()},h(){o(r,"kind","captions"),e.autoplay=!0,o(e,"class",n=t[2].class+" w-96 rotate-90 self-center")},m(l,d){y(l,e,d),w(e,r),i||(a=Qe(t[1].call(null,e)),i=!0)},p(l,d){d&4&&n!==(n=l[2].class+" w-96 rotate-90 self-center")&&o(e,"class",n)},d(l){l&&h(e),i=!1,a()}}}function Mt(t){let e;function r(a,l){return a[0]&&a[0].state=="ready"?$t:Rt}let n=r(t),i=n(t);return{c(){i.c(),e=pe()},l(a){i.l(a),e=pe()},m(a,l){i.m(a,l),y(a,e,l)},p(a,[l]){n===(n=r(a))&&i?i.p(a,l):(i.d(1),i=n(a),i&&(i.c(),i.m(e.parentNode,e)))},i:q,o:q,d(a){i.d(a),a&&h(e)}}}function Nt(t,e,r){let{mediaState:n}=e;function i(a){n&&n.state=="ready"&&(a.srcObject=n.mediaStream)}return t.$$set=a=>{r(2,e=de(de({},e),ce(a))),"mediaState"in a&&r(0,n=a.mediaState)},e=ce(e),[n,i,e]}class Pt extends X{constructor(e){super();Z(this,e,Nt,Mt,G,{mediaState:0})}}function At(t){let e,r,n,i,a,l,d,s,f,c,m,k;return d=new Pt({props:{mediaState:t[1],class:"flex flex-grow place-content-center place-items-center bg-black rounded-2xl"}}),c=new yt({props:{directionFn:t[5]}}),{c(){e=I("div"),r=I("div"),n=I("span"),i=W("Device Id"),a=W(t[0]),l=N(),E(d.$$.fragment),s=N(),f=I("div"),E(c.$$.fragment),this.h()},l(u){e=O(u,"DIV",{class:!0});var v=_(e);r=O(v,"DIV",{class:!0});var p=_(r);n=O(p,"SPAN",{class:!0});var S=_(n);i=F(S,"Device Id"),S.forEach(h),a=F(p,t[0]),p.forEach(h),l=P(v),J(d.$$.fragment,v),s=P(v),f=O(v,"DIV",{class:!0});var b=_(f);J(c.$$.fragment,b),b.forEach(h),v.forEach(h),this.h()},h(){o(n,"class","bg-light-gray text-bluestrong text-sm font-medium mr-2 px-2.5 py-0.5 rounded"),o(r,"class","my-3"),o(f,"class","m-3 self-center"),o(e,"class",m=t[3].class)},m(u,v){y(u,e,v),w(e,r),w(r,n),w(n,i),w(r,a),w(e,l),T(d,e,null),w(e,s),w(e,f),T(c,f,null),k=!0},p(u,[v]){(!k||v&1)&&Ae(a,u[0]);const p={};v&2&&(p.mediaState=u[1]),d.$set(p),(!k||v&8&&m!==(m=u[3].class))&&o(e,"class",m)},i(u){k||(D(d.$$.fragment,u),D(c.$$.fragment,u),k=!0)},o(u){R(d.$$.fragment,u),R(c.$$.fragment,u),k=!1},d(u){u&&h(e),B(d),B(c)}}}function Et(t,e,r){let{peerId:n}=e,{mediaState:i}=e,{directionFn:a}=e;const l=Dt(a),d=s=>{l(s)};return t.$$set=s=>{r(3,e=de(de({},e),ce(s))),"peerId"in s&&r(0,n=s.peerId),"mediaState"in s&&r(1,i=s.mediaState),"directionFn"in s&&r(4,a=s.directionFn)},e=ce(e),[n,i,l,e,a,d]}class Jt extends X{constructor(e){super();Z(this,e,Et,At,G,{peerId:0,mediaState:1,directionFn:4})}}function $e(t,e,r){const n=t.slice();return n[6]=e[r],n}function Tt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=U(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(h),i.forEach(h),this.h()},h(){o(r,"stroke-linecap","round"),o(r,"stroke-linejoin","round"),o(r,"stroke-width","2"),o(r,"d","M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-6 w-6 mr-2"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(n,i){y(n,e,i),w(e,r)},d(n){n&&h(e)}}}function Bt(t){let e,r;return{c(){e=x("svg"),r=x("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,class:!0,fill:!0,viewBox:!0,stroke:!0});var i=_(e);r=U(i,"path",{"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-width":!0,d:!0}),_(r).forEach(h),i.forEach(h),this.h()},h(){o(r,"stroke-linecap","round"),o(r,"stroke-linejoin","round"),o(r,"stroke-width","2"),o(r,"d","M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"),o(e,"xmlns","http://www.w3.org/2000/svg"),o(e,"class","h-6 w-6 mr-2"),o(e,"fill","none"),o(e,"viewBox","0 0 24 24"),o(e,"stroke","currentColor")},m(n,i){y(n,e,i),w(e,r)},d(n){n&&h(e)}}}function Me(t,e){let r,n,i,a,l=e[6].streamId+"",d,s,f,c,m,k,u,v;function p(A,V){return A[6].isMobile?Bt:Tt}let S=p(e),b=S(e);function $(){return e[4](e[6])}function M(){return e[5](e[6])}return{key:t,first:null,c(){r=I("div"),n=I("div"),b.c(),i=N(),a=I("div"),d=W(l),s=N(),f=I("button"),c=W("X"),k=N(),this.h()},l(A){r=O(A,"DIV",{class:!0});var V=_(r);n=O(V,"DIV",{class:!0});var Q=_(n);b.l(Q),i=P(Q),a=O(Q,"DIV",{});var le=_(a);d=F(le,l),le.forEach(h),s=P(Q),f=O(Q,"BUTTON",{class:!0});var fe=_(f);c=F(fe,"X"),fe.forEach(h),Q.forEach(h),k=P(V),V.forEach(h),this.h()},h(){o(f,"class","rounded-md bg-red px-2"),o(n,"class",m="flex flex-row justify-between rounded-lg p-1 "+(e[3]==e[6].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400"),o(r,"class","box-border my-2 px-3 "),this.first=r},m(A,V){y(A,r,V),w(r,n),b.m(n,null),w(n,i),w(n,a),w(a,d),w(n,s),w(n,f),w(f,c),w(r,k),u||(v=[Y(f,"click",$),Y(n,"click",M)],u=!0)},p(A,V){e=A,S!==(S=p(e))&&(b.d(1),b=S(e),b&&(b.c(),b.m(n,i))),V&1&&l!==(l=e[6].streamId+"")&&Ae(d,l),V&9&&m!==(m="flex flex-row justify-between rounded-lg p-1 "+(e[3]==e[6].streamId?"bg-bluelight":"bg-light")+" border-2 hover:bg-sky-200 cursor-pointer transition-transform origin-right duration-100 hover:border-2 hover:border-sky-400")&&o(n,"class",m)},d(A){A&&h(r),b.d(),u=!1,Pe(v)}}}function xt(t){let e,r,n,i,a,l=[],d=new Map,s=t[0];const f=c=>c[6].streamId;for(let c=0;c<s.length;c+=1){let m=$e(t,s,c),k=f(m);d.set(k,l[c]=Me(k,m))}return{c(){e=I("div"),r=I("div"),n=W("Available devices"),i=N(),a=I("div");for(let c=0;c<l.length;c+=1)l[c].c();this.h()},l(c){e=O(c,"DIV",{class:!0});var m=_(e);r=O(m,"DIV",{class:!0});var k=_(r);n=F(k,"Available devices"),k.forEach(h),m.forEach(h),i=P(c),a=O(c,"DIV",{class:!0});var u=_(a);for(let v=0;v<l.length;v+=1)l[v].l(u);u.forEach(h),this.h()},h(){o(r,"class","text-center text-gray"),o(e,"class","w-full shadow-sm py-2"),o(a,"class","overflow-y-scroll")},m(c,m){y(c,e,m),w(e,r),w(r,n),y(c,i,m),y(c,a,m);for(let k=0;k<l.length;k+=1)l[k].m(a,null)},p(c,[m]){m&15&&(s=c[0],l=Ye(l,m,f,1,c,s,d,a,je,Me,null,$e))},i:q,o:q,d(c){c&&h(e),c&&h(i),c&&h(a);for(let m=0;m<l.length;m+=1)l[m].d()}}}function Ut(t,e,r){let{devices:n}=e,{selectDevice:i}=e,{deleteDevice:a}=e,l="";const d=f=>a(f.streamId),s=f=>{r(3,l=f.streamId),i(f.streamId)};return t.$$set=f=>{"devices"in f&&r(0,n=f.devices),"selectDevice"in f&&r(1,i=f.selectDevice),"deleteDevice"in f&&r(2,a=f.deleteDevice)},[n,i,a,l,d,s]}class Kt extends X{constructor(e){super();Z(this,e,Ut,xt,G,{devices:0,selectDevice:1,deleteDevice:2})}}function Vt(t){let e,r;return e=new dt({props:{slot:"topbar"}}),{c(){E(e.$$.fragment)},l(n){J(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p:q,i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function Ht(t){let e,r;return{c(){e=I("div"),r=W("Select a device"),this.h()},l(n){e=O(n,"DIV",{class:!0});var i=_(e);r=F(i,"Select a device"),i.forEach(h),this.h()},h(){o(e,"class","flex flex-grow place-items-center place-content-center text-xl text-gray")},m(n,i){y(n,e,i),w(e,r)},p:q,i:q,o:q,d(n){n&&h(e)}}}function Lt(t){let e,r;return e=new Jt({props:{class:"flex flex-grow flex-col shadow-lg p-4 border-2 border-gray-100 rounded-lg",peerId:t[2].peerId,mediaState:t[1],directionFn:t[6]}}),{c(){E(e.$$.fragment)},l(n){J(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p(n,i){const a={};i&4&&(a.peerId=n[2].peerId),i&2&&(a.mediaState=n[1]),i&8&&(a.directionFn=n[6]),e.$set(a)},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function Wt(t){let e,r,n,i,a,l,d,s,f,c,m,k;const u=[Lt,Ht],v=[];function p(S,b){return S[2]&&S[2].type=="Peered"?0:1}return d=p(t),s=v[d]=u[d](t),m=new Kt({props:{selectDevice:t[7],deleteDevice:t[8],devices:t[0]}}),{c(){e=I("div"),r=I("div"),n=I("div"),i=W("Control center for device: "),a=W(t[4]),l=N(),s.c(),f=N(),c=I("div"),E(m.$$.fragment),this.h()},l(S){e=O(S,"DIV",{slot:!0,class:!0});var b=_(e);r=O(b,"DIV",{class:!0});var $=_(r);n=O($,"DIV",{class:!0});var M=_(n);i=F(M,"Control center for device: "),a=F(M,t[4]),M.forEach(h),l=P($),s.l($),$.forEach(h),f=P(b),c=O(b,"DIV",{class:!0});var A=_(c);J(m.$$.fragment,A),A.forEach(h),b.forEach(h),this.h()},h(){o(n,"class","textxl text-gray"),o(r,"class","flex flex-grow flex-col m-5"),o(c,"class","flex flex-col flex-grow max-w-md shadow-md"),o(e,"slot","main"),o(e,"class","flex flex-row flex-grow")},m(S,b){y(S,e,b),w(e,r),w(r,n),w(n,i),w(n,a),w(r,l),v[d].m(r,null),w(e,f),w(e,c),T(m,c,null),k=!0},p(S,b){let $=d;d=p(S),d===$?v[d].p(S,b):(it(),R(v[$],1,1,()=>{v[$]=null}),at(),s=v[d],s?s.p(S,b):(s=v[d]=u[d](S),s.c()),D(s,1),s.m(r,null));const M={};b&8&&(M.selectDevice=S[7]),b&8&&(M.deleteDevice=S[8]),b&1&&(M.devices=S[0]),m.$set(M)},i(S){k||(D(s),D(m.$$.fragment,S),k=!0)},o(S){R(s),R(m.$$.fragment,S),k=!1},d(S){S&&h(e),v[d].d(),B(m)}}}function Ft(t){let e,r;return e=new ot({props:{$$slots:{main:[Wt],topbar:[Vt]},$$scope:{ctx:t}}}),{c(){E(e.$$.fragment)},l(n){J(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p(n,[i]){const a={};i&1039&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function zt(t,e,r){let n,i;et(t,ct,u=>r(5,i=u));let a=tt(),l=[],d,s,f;rt(async()=>{n.type=="LoggedIn"&&(r(3,f=new wt({clientId:a,uid:n.user.uid,onDevices:u=>{r(0,l=u.filter(v=>v.streamId!=a&&v.isMobile))},onMedia:u=>{r(1,d=u)},signalingServerUrl:lt.robotService.url,token:await n.user.getIdToken()})),f.start(),f.state.subscribe({next:u=>{r(2,s=u)}}))}),nt(()=>{f==null||f.stop()});const c=u=>{f.sendMessage(vt.encode(u).finish())},m=u=>{f.call(u)},k=u=>{f.closeDeviceStream(u)};return t.$$.update=()=>{t.$$.dirty&32&&(n=i.authState)},[l,d,s,f,a,i,c,m,k]}class qt extends X{constructor(e){super();Z(this,e,zt,Ft,G,{})}}function Xt(t){let e,r;return e=new qt({}),{c(){E(e.$$.fragment)},l(n){J(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function Zt(t){let e,r;return e=new st({props:{denyIfNotAuthenticated:!0,$$slots:{default:[Xt]},$$scope:{ctx:t}}}),{c(){E(e.$$.fragment)},l(n){J(e.$$.fragment,n)},m(n,i){T(e,n,i),r=!0},p(n,[i]){const a={};i&1&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){r||(D(e.$$.fragment,n),r=!0)},o(n){R(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}class rr extends X{constructor(e){super();Z(this,e,null,Zt,G,{})}}export{rr as default};
